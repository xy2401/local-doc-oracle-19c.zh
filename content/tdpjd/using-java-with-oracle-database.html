<html lang="en-us"  xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>数据库中的JDBC，UCP和Java简介</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="2 Day + Java Developer&#39;s Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="2 Day + Java Developer&#39;s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="2-day-java-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-12T07:23:23-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2007, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96442-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="aims-and-objectives-this-book.html" title="Previous" type="text/html">
      <link rel="next" href="overview-hr-web-application.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="2 Day + Java Developer&#39;s Guide">
    <meta name="dcterms.isVersionOf" content="TDPJD">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body >
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="aims-and-objectives-this-book.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="overview-hr-web-application.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">2天+ Java开发人员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">数据库中的JDBC，UCP和Java简介</li>
            </ol>
            <a id="GUID-8C73108B-E0F3-4CD5-A813-909B339339BB" name="GUID-8C73108B-E0F3-4CD5-A813-909B339339BB"></a><a id="TDPJD101"></a>
            
            <h2 id="TDPJD-GUID-8C73108B-E0F3-4CD5-A813-909B339339BB" class="sect2"><span class="enumeration_chapter">2</span>数据库中的JDBC，UCP和Java简介</h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle数据库是一个关系数据库，可用于存储，修改和使用数据。</p>
               <p>该<a id="d2341e26" class="indexterm-anchor"></a> Java应用程序使用Java数据库连接（JDBC）标准来访问和操作关系数据库中的数据。
               </p>
               <p><a id="d2341e30" class="indexterm-anchor"></a> JDBC是一种行业标准的应用程序编程接口（API），允许您使用Java中的SQL访问RDBMS。JDBC符合<a id="d2341e33" class="indexterm-anchor"></a> JDBC转义标准的入门级别。每个供应商都使用自己的扩展实现JDBC规范。
               </p>
               <p>通用连接池（UCP）是一个连接池，用于缓存数据库连接对象以重用连接，从而提高性能。</p>
               <p>数据库中的Java（OJVM）帮助将SQL操作与Java数据逻辑分组，并将它们加载到数据库中以进行就地处理。</p>
               <div class="infoboxnotealso" id="GUID-8C73108B-E0F3-4CD5-A813-909B339339BB__GUID-9E38004F-8DB0-4A86-BCA9-A203D03D2E43">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="http://www.oracle.com/technetwork/java/overview-141217.html" target="_blank"><code class="codeph">http://www.oracle.com/technetwork/java/overview-141217.html</code></a></p>
               </div>
               <p></p>
               <p>本章向您介绍使用Oracle Database 12 <span class="italic">c</span>第2版（12.2）的JDBC驱动程序，通用连接池（UCP）和数据库中的Java（OJVM）</p>
               <ul style="list-style-type:disc">
                  <li>Java数据库连接驱动程序（JDBC）</li>
                  <li>
                     <p>通用连接池（UCP）</p>
                  </li>
                  <li>
                     <p>数据库中的Java（OJVM）</p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-2ADAB75C-88C9-4956-98C3-FE0ED96444CA" name="GUID-2ADAB75C-88C9-4956-98C3-FE0ED96444CA"></a><h3 id="TDPJD-GUID-2ADAB75C-88C9-4956-98C3-FE0ED96444CA" class="sect3">Java数据库连接驱动程序（JDBC）</h3>
               <div>
                  <p>JDBC是一种数据库访问协议，使您可以连接到数据库并在数据库上运行SQL语句和查询。JDBC驱动程序实现并符合最新的JDBC规范。Java应用程序需要在其类路径<code class="codeph">ojdbc8.jar</code>与JDK8兼容。
                  </p>
                  <p>核心Java类库提供JDBC API， <code class="codeph">java.sql</code>和<code class="codeph">javax.sql</code></p>
                  <p>以下部分描述了Oracle对JDBC标准的支持：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>Oracle JDBC瘦驱动程序</p>
                     </li>
                     <li>
                        <p>Oracle JDBC包</p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-2ADAB75C-88C9-4956-98C3-FE0ED96444CA__GUID-32623499-6C25-4160-B67A-8FFCC9FDDCEE">Oracle JDBC瘦驱动程序</p>
                     <p>Oracle建议使用JDBC Thin Driver满足大多数要求。JDBC Thin Driver可以在任何具有合适Java虚拟机的系统上运行。（JVM）。Oracle提供的其他一些客户端驱动程序是JDBC瘦驱动程序，Oracle调用接口（OCI）驱动程序，服务器端瘦驱动程序和服务器端内部驱动程序。</p>
                     <p>JDBC Thin Driver是一个纯Java，Type IV驱动程序。JDBC驱动程序版本）ojdbc8.jar）包含对JDK 8的支持。</p>
                     <p>JDBC Thin Driver使用SQL * Net与服务器通信以访问数据库。</p>
                     <div class="infoboxnotealso" id="GUID-2ADAB75C-88C9-4956-98C3-FE0ED96444CA__GUID-49DC1247-511A-42D7-BEAA-68F742FC6906">
                        <p class="notep1">也可以看看：</p><span><cite>Oracle数据库JDBC开发人员指南</cite></span></div>
                     <p><span class="bold">操作项1：</span>更改DB_URL以指向您的数据库。如果您需要帮助，请参阅Github上的DataSourceSample.java。
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>import java.sql.Connection;
import java.sql.SQLException;
import java.sql.DatabaseMetaData;

import oracle.jdbc.pool.OracleDataSource;
import oracle.jdbc.OracleConnection;

public class DataSourceSample {  
  // The recommended format of a connection URL is the long format with the
  // connection descriptor.
  // final static String DB_URL= "jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS=(HOST=myhost)(PORT=1521)(PROTOCOL=tcp))(CONNECT_DATA=(SERVICE_NAME=myorcldbservicename)))";

  final static String DB_URL= "jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS=(HOST=localhost)(PORT=5521)(PROTOCOL=tcp))(CONNECT_DATA=(SERVICE_NAME=<span class="italic">service name</span>)))";
  final static String DB_USER = "<span class="italic">username</span>";
  final static String DB_PASSWORD = <span class="italic">password</span>;

  public static void main (String args[]) throws SQLException {

    OracleDataSource ods = new OracleDataSource();
    ods.setURL(DB_URL);    
    ods.setUser(DB_USER);
    ods.setPassword(DB_PASSWORD);

    // With AutoCloseable, the connection is closed automatically.
    try (OracleConnection connection = (OracleConnection)  
      ods.getConnection()) {
      // Get the JDBC driver name and version 
      DatabaseMetaData dbmd = connection.getMetaData();       
      System.out.println("Driver Name: " + dbmd.getDriverName());
      System.out.println("Driver Version: " + 
        dbmd.getDriverVersion());
      System.out.println("Database Username is: " + 
        connection.getUserName());
    }   
  }
}
</code></pre></div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-E59E9147-A57F-4331-95E4-8A99B5B6774D" name="GUID-E59E9147-A57F-4331-95E4-8A99B5B6774D"></a><h3 id="TDPJD-GUID-E59E9147-A57F-4331-95E4-8A99B5B6774D" class="sect3">通用连接池</h3>
               <div>
                  <p>连接池通过重用连接对象和减少创建连接对象的次数来帮助提高性能。</p>
                  <p>Oracle通用连接池（UCP）是一个功能丰富的Java连接池，通过与Oracle数据库配置的更紧密集成，提供连接池功能，高可用性，可伸缩性和负载平衡。</p>
                  <p>Java应用程序或容器必须在其类路径中使用<code class="codeph">ucp.jar</code>以及<code class="codeph">ojdbc8.jar</code> （JDK8）才能使用UCP。</p>
                  <div class="infoboxnotealso" id="GUID-E59E9147-A57F-4331-95E4-8A99B5B6774D__GUID-A0292E63-4C57-4556-9418-68881BEC1345">
                     <p class="notep1">也可以看看：</p><span><cite>Oracle通用连接池开发人员指南</cite></span></div>
                  <p><span class="bold">操作项2：</span>更改DB_URL以指向您的数据库。
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>Import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import oracle.ucp.jdbc.PoolDataSourceFactory;
import oracle.ucp.jdbc.PoolDataSource;

public class UCPSample {
  // final static String DB_URL=   "jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS=(HOST=myhost)(PORT=1521)(PROTOCOL=tcp))(CONNECT_DATA=(SERVICE_NAME=myorcldbservicename)))";
 
  final static String DB_USER = "<span class="italic">username</span>";
  final static String DB_PASSWORD = "<span class="italic">pwd</span>";
  final static String CONN_FACTORY_CLASS_NAME = "oracle.jdbc.pool.OracleDataSource";

  /*
   * The sample demonstrates UCP as client side connection pool.
   */
  public static void main(String args[]) throws Exception {
    // Get the PoolDataSource for UCP
    PoolDataSource pds = PoolDataSourceFactory.getPoolDataSource();

    // Set the connection factory first before all other properties
    pds.setConnectionFactoryClassName(CONN_FACTORY_CLASS_NAME);
    pds.setURL(DB_URL);
    pds.setUser(DB_USER);
    pds.setPassword(DB_PASSWORD);
    pds.setConnectionPoolName("JDBC_UCP_POOL");

    // Default is 0. Set the initial number of connections to be 
    // created when UCP is started.
    pds.setInitialPoolSize(5);

    // Default is 0. Set the minimum number of connections
    // that is maintained by UCP at runtime.
    pds.setMinPoolSize(5);

    // Default is Integer.MAX_VALUE (2147483647). Set the maximum 
    // number of connections allowed on the connection pool.
    pds.setMaxPoolSize(20);

    // Default is 30secs. Set the frequency in seconds to enforce 
    // the timeout properties. Applies to    
    // inactiveConnectionTimeout(int secs),
    // AbandonedConnectionTimeout(secs)&amp; 
    //TimeToLiveConnectionTimeout(int secs).
    // Range of valid values is 0 to Integer.MAX_VALUE.
    pds.setTimeoutCheckInterval(5);

    // Default is 0. Set the maximum time, in seconds, that a
    // connection remains available in the connection pool.
    pds.setInactiveConnectionTimeout(10);

    System.out.println("Available connections before checkout: "
        + pds.getAvailableConnectionsCount());
    System.out.println("Borrowed connections before checkout: "
        + pds.getBorrowedConnectionsCount());
    // Get the database connection from UCP.
    try (Connection conn = pds.getConnection()) {
      System.out.println("Available connections after checkout: "
          + pds.getAvailableConnectionsCount());
      System.out.println("Borrowed connections after checkout: "
          + pds.getBorrowedConnectionsCount());
      // Perform a database operation
      printEmployees(conn);
    } catch (SQLException e) {
      System.out.println("UCPSample - " + "SQLException occurred : "
          + e.getMessage());
    }
    System.out.println("Available connections after checkin: "
        + pds.getAvailableConnectionsCount());
    System.out.println("Borrowed connections after checkin: "
        + pds.getBorrowedConnectionsCount());
  }
 /*
  * Displays first_name and last_name from the employees table.
  */
  public static void printEmployees(Connection connection) 
     throws SQLException {
    // Statement and ResultSet are AutoCloseable and closed 
    // automatically. 
    try (Statement statement = connection.createStatement()) {      
      try (ResultSet resultSet = statement
          .executeQuery("select first_name, last_name from 
            employees")) {
        System.out.println("FIRST_NAME" + "  " + "LAST_NAME");
        System.out.println("---------------------");
        while (resultSet.next())
          System.out.println(resultSet.getString(1) + " "
              + resultSet.getString(2) + " ");       
      }
    }   
  } 
}
</code></pre></div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-5414DE01-3133-490E-9D8F-A31B578C35E6" name="GUID-5414DE01-3133-490E-9D8F-A31B578C35E6"></a><h3 id="TDPJD-GUID-5414DE01-3133-490E-9D8F-A31B578C35E6" class="sect3">数据库中的Java（OJVM）</h3>
               <div>
                  <p>Oracle数据库具有驻留在服务器中的Java虚拟机（JVM）。它可以帮助在服务器上的Oracle JVM中运行的Java应用程序访问同一系统和同一进程中存在的数据。</p>
                  <p>建议将数据库中的Java用于数据密集型应用程序。JVM能够直接使用底层Oracle RDBMS库，而无需在Java代码和SQL数据之间使用网络连接。这有助于提高性能和执行。对于数据访问，当Java代码在服务器上运行时，Oracle数据库使用服务器端内部驱动程序。</p>
                  <p><span class="bold">行动项目3：</span>上通过SQLPLUS连接到数据库并运行<a href="https://github.com/oracle/oracle-db-examples/blob/master/java/ojvm/ServersideConnect.sql" target="_blank">ServersideConnect.sql</a>调用之前<a href="https://github.com/oracle/oracle-db-examples/blob/master/java/ojvm/ServersideConnect.java" target="_blank">ServersideConnect.java</a> 。有关更多信息，请参阅Github的示例。
                  </p>
                  <p><span class="bold">ServersideConnect.sql</span></p>
                  <div class="p"><pre class="pre codeblock"><code>
Rem NAME
Rem ServersideConnect.sql 
Rem
Rem DESCRIPTION
Rem SQL for invoking the method which gets a server side connection to
rem Reads the content of the Java source from ServersideConnect.java 
rem then compiles it 
connect <span class="italic">username</span>/<span class="italic">pwd</span>
CREATE OR REPLACE AND COMPILE JAVA SOURCE NAMED ServersideConnect_src AS
@ ServersideConnect.java
/
show error
rem A wrapper (a.k.a. Call Spec), to invoke Java
rem function in the database from SQL, PL/SQL, and client applications
CREATE OR REPLACE PROCEDURE ServersideConnect_proc AS 
LANGUAGE JAVA NAME 'ServersideConnect.jrun ()';
/
rem running the sample
connect <span class="italic">username</span>/<span class="italic">pwd</span>
SET SERVEROUTPUT ON SIZE 10000 
CALL dbms_java.set_output (10000);

execute ServersideConnect_proc;


InternalT2Server.java
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import oracle.jdbc.driver.OracleDriver;
import oracle.jdbc.pool.OracleDataSource;

public class ServersideConnect {

  static public void jrun() throws SQLException {
    // For testing ServersideConnect
    // test("jdbc:oracle:kprb:@");
    method1("jdbc:default:connection");
    method2();
  }  
 /*
  * Shows using the server side Type 2 driver a.k.a KPRB driver 
  */ 
 static public void method1 (String url) throws SQLException {
    Connection connection = null; 
    try {
     // Method 1: Using OracleDataSource
      OracleDataSource ods = new OracleDataSource();
      ods.setURL(url);
      connection = ods.getConnection();
      System.out.println("Method 1: Getting Default Connection "
          + "using OracleDataSource");
      // Perform database operation
      printEmployees(connection);
    }
}

static public void method2 () throws SQLException {
   Connection connection = null; 
   try {
        OracleDriver ora = new OracleDriver();
        connection = ora.defaultConnection();
        System.out.println("Method 2: Getting Default Connection "
          + "using OracleDriver");
        // Perform database operation
        printEmployees(connection);
   }
}

 /*
  * Displays employee_id and first_name from the employees table.
  */
  static public void printEmployees(Connection connection) 
     throws SQLException {
    ResultSet resultSet = null;
    Statement statement = null;
    try {
      statement = connection.createStatement();
      resultSet = statement.executeQuery("SELECT employee_id, first_name" 
         +    " FROM employees order by employee_id");
      while (resultSet.next()) {
        System.out.println("Emp no: " + resultSet.getInt(1) + " Emp name: "
            + resultSet.getString(2));
      }
    }
    catch (SQLException ea) {
      System.out.println("Error during execution: " + ea);
      ea.printStackTrace();
    }
    finally {
      if (resultSet != null) resultSet.close();
      if (statement != null) statement.close();   
    }
  }
}

</code></pre></div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>