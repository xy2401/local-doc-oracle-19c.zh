<html lang="en-us"  xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="These examples show the steps to complete preupgrade checks, upgrade, and postupgrade checks for an Oracle Database 11g Release 2 (11.2.0.4) upgrade to Oracle Database 19c.">
      <meta name="description" content="These examples show the steps to complete preupgrade checks, upgrade, and postupgrade checks for an Oracle Database 11g Release 2 (11.2.0.4) upgrade to Oracle Database 19c.">
      <title>Windows非CDB Oracle数据库的手动升级示例</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database Upgrade Guide">
      <meta property="og:description" content="These examples show the steps to complete preupgrade checks, upgrade, and postupgrade checks for an Oracle Database 11g Release 2 (11.2.0.4) upgrade to Oracle Database 19c.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database Upgrade Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-upgrade-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-04-25T08:26:31-07:00">
      <meta name="dcterms.title" content="Database Upgrade Guide">
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96252-05">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="upgrade-scenarios-non-cdb-oracle-databases.html" title="Previous" type="text/html">
      <link rel="next" href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="UPGRD">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body >
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="upgrade-scenarios-non-cdb-oracle-databases.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库升级指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="upgrading-oracle-database.html" property="item" typeof="WebPage"><span property="name">升级Oracle数据库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Windows非CDB Oracle数据库的手动升级示例</li>
            </ol>
            <a id="GUID-30F3DC9C-141A-47DC-9B83-6D0C395E565C" name="GUID-30F3DC9C-141A-47DC-9B83-6D0C395E565C"></a>
            
            <h2 id="UPGRD-GUID-30F3DC9C-141A-47DC-9B83-6D0C395E565C" class="sect2">Windows非CDB Oracle数据库的手动升级示例</h2>
         </header>
         <div class="ind">
            <div>
               <p>这些示例显示了完成Oracle Database 11g第2版（11.2.0.4）升级到Oracle Database 19c的预升级检查，升级和升级后检查的步骤。</p>
               <p>这些主题中的特定示例显示了Microsoft Windows平台上的升级。他们使用特定于Windows环境的工具。但是，这些示例提供了手动安装体验的概述。</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="example-manual-upgrade-windows-non-cdb-11203-to-122.html#GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC">准备使用命令行实用程序升级Windows非CDB</a><br>在将非CDB Oracle Database 11g第2版（11.2.0.4）数据库升级到非CDB Oracle Database 12c及更高版本之前，请完成所需的预升级步骤。
                  </li>
                  <li class="ulchildlink"><a href="example-manual-upgrade-windows-non-cdb-11203-to-122.html#GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263">使用命令行实用程序手动升级Windows非CDB</a><br>这些示例显示了将非CDB Oracle Database 11g第2版（11.2.0.4）升级到非CDB Oracle数据库的升级步骤</li>
                  <li class="ulchildlink"><a href="example-manual-upgrade-windows-non-cdb-11203-to-122.html#GUID-B5A840F4-912B-4DAD-82CA-94522140DB14">升级非CDB数据库后运行Postupgrade修复脚本</a><br>这些示例显示了为非CDB升级到非CDB升级的<code>postupgrade_fixups.sql</code>脚本的过程。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="upgrading-oracle-database.html#GUID-CC88F262-3370-4FFA-8604-EDA9F20F56D9" title="Oracle提供了一套全面的工具，用于以最短的停机时间升级Oracle数据库，以及将应用程序迁移到新版本。">升级Oracle数据库</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC" name="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC"></a><h3 id="UPGRD-GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC" class="sect3">准备使用命令行实用程序升级Windows非CDB</h3>
               <div>
                  <p>在将非CDB Oracle Database 11g第2版（11.2.0.4）数据库升级到非CDB Oracle Database 12c及更高版本之前，请完成所需的预升级步骤。</p>
                  <div class="section">
                     <p>此过程提供了一个示例，说明如何使用命令行实用程序准备系统，以便在Windows上将非CDB Oracle数据库手动升级到当前版本的非CDB Oracle数据库。在此示例中，要升级的Oracle数据库是Oracle Database 11g第2版（11.2.0.4）。</p>
                     <p>以作为<code class="codeph">ORA_DBA</code>组成员的用户身份登录。Oracle建议您在服务器上安装新版本的Oracle Database二进制文件。请参阅Windows的Oracle数据库安装指南以完成该过程。
                     </p>
                     <p>Preupgrade包含以下步骤：</p>
                     <ol>
                        <li>
                           <p>将用户环境变量从新版Oracle主目录重置为Oracle安装所有者用户帐户（Oracle用户）的11.2.0.4 Oracle主目录。</p>
                        </li>
                        <li>
                           <p>测试与11.2.0.4 Oracle数据库的连接。</p>
                        </li>
                        <li>
                           <p>在11.2.0.4 Oracle数据库主目录上运行升级前信息工具。</p>
                        </li>
                        <li>
                           <p>查看升级前信息工具日志（ <code class="codeph">preupgrade.log</code> ）。如果必须运行<code>preupgrade_fixups.sql</code>脚本，则运行它们。在此示例中，我们显示以下错误的手动修复：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>存在Oracle Enterprise Manager（ <code class="codeph">em_present</code> ）。
                                 </p>
                              </li>
                              <li>
                                 <p>存在OLAP目录（ <code class="codeph">amd_exists</code> ）。
                                 </p>
                              </li>
                              <li>
                                 <p>必须授予ADMINISTER DATABASE TRIGGER权限（ <code class="codeph">trgowner_no_admndbtrg</code> ）。
                                 </p>
                              </li>
                              <li>
                                 <p>物化视图不会刷新（ <code class="codeph">mv_refresh</code> ）。
                                 </p>
                              </li>
                              <li>
                                 <p>Oracle Application Express未升级（ <code class="codeph">apex_upgrade_msg</code> ）</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>运行<code>preupgrade_fixups.sql</code>脚本。
                           </p>
                        </li>
                        <li>
                           <p>备份数据库。</p>
                        </li>
                     </ol>
                     <p>这些示例使用以下系统，路径和用户：</p>
                     <p>Oracle Database 11g第2版（11.2.0.4）</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>Oracle Installation Owner用户帐户： <code class="codeph">oracle1</code> ，它是ORA_DBA组的成员。
                           </p>
                        </li>
                        <li>
                           <p>Oracle主目录： <code class="codeph">C:\app\oracle\product\11.2.0\dbhome_1</code></p>
                        </li>
                     </ul>
                     <p>Oracle数据库19c</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>Oracle Installation Owner用户帐户： <code class="codeph">oracle2</code> ，它是ORA_DBA组的成员。
                           </p>
                        </li>
                        <li>
                           <p>Oracle主目录： <code class="codeph">C:\app\oracle1\product\19\dbhome_1</code></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-DDFE745A-0FEC-4BF4-885A-93DEB83A7FBE">
                     <p class="titleinexample">示例4-6重置用户环境变量</p>
                     <p>此示例显示如何从为Oracle Database 19c安装设置的值更改环境变量：</p><pre class="pre codeblock"><code>C:\app\oracle1\product\19\dbhome_1\rdbms\admin&gt;set ORACLE_HOME=C:\app\oracle2\product\11.2.0\dbhome_1
C:\app\oracle1\product\19\dbhome_1\rdbms\admin&gt;set ORACLE_SID=orcl11</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-E49BE1A5-0BDD-4D07-81AD-325D2391ED68">
                     <p class="titleinexample">示例4-7测试与数据库的连接</p>
                     <p>此示例显示如何测试与数据库的连接，并确保您要连接到要升级的版本11.2.0.4数据库。</p><pre class="pre codeblock"><code>C:\app\oracle1\product\19\dbhome_1\rdbms\admin&gt;sqlplus / as sysdba

	SQL*Plus: Release 11.2.0.4.0 Production on Tue Dec 11 12:14:49 2018

	Copyright (c) 1982, 2011, Oracle.  All rights reserved.


	Connected to:
	Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production
	With the Partitioning, OLAP, Data Mining and Real Application Testing options

	SQL&gt; select version from v$instance;

	VERSION
	-----------------
	11.2.0.4.0

	SQL&gt;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-40FFB6B6-30FF-4407-A476-A5FE3989C958">
                     <p class="titleinexample">示例4-8运行升级前信息工具（preupgrade.jar）</p>
                     <p>此示例显示如何使用命令<code class="codeph">java -jar %ORACLE_HOME19%\rdbms\admin\preupgrade.jar</code>运行该工具。
                     </p>
                     <p>Preupgrade信息工具打印日志文件的路径，并打印修复脚本的路径。默认情况下，这些修复脚本放在<code class="codeph">%ORACLE_BASE%</code> 。
                     </p><pre class="pre codeblock"><code>C:\app\oracle1\product\19\dbhome_1\rdbms\admin&gt;java -jar preupgrade.jar

Preupgrade generated files:
        C:\app\oracle2\cfgtoollogs\orcl11\preupgrade\preupgrade.log
        C:\app\oracle2\cfgtoollogs\orcl11\preupgrade\preupgrade_fixups.sql
        C:\app\oracle2\cfgtoollogs\orcl11\preupgrade\postupgrade_fixups.sql
C:\app\oracle1\product\12.2.0\dbhome_1\rdbms\admin&gt;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-CF7DDC7E-99CD-4E6A-9F99-778809D35C04">
                     <p class="titleinexample">示例4-9查看升级前信息工具日志（preupgrade.log）</p>
                     <p>在此示例中，日志文件<code class="codeph">preupgrade.log</code>在以下路径中生成： <code>C:\app\oracle2\cfgtoollogs\orcl11\preupgrade\preupgrade.log</code> 。
                     </p>
                     <p>日志文件可以指导您手动运行一些SQL修复文件。如果它指示您运行SQL文件，则将这些文件复制到早期版本11.2.0.4 Oracle主目录，然后运行脚本。</p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-C71312F3-AEE1-4D03-96F5-01A6EDAB5119">
                     <p class="titleinexample">示例4-10运行Preupgrade Fixup SQL脚本（preupgrade_fixups.sql）</p><pre class="pre codeblock"><code>C:\app\oracle1\product\19\dbhome_1\rdbms\admin&gt;sqlplus / as sysdba @C:\app\oracle2\cfgtoollogs\orcl11\preupgrade\preupgrade_fixups.sql

	SQL*Plus: Release 11.2.0.4.0 Production on Tue Dec 11 12:34:08 2018

	Copyright (c) 1982, 2011, Oracle.  All rights reserved.


	Connected to:
	Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production
	With the Partitioning, OLAP, Data Mining and Real Application Testing options

	Executing Oracle PRE-Upgrade Fixup Script

	Auto-Generated by:       Oracle Preupgrade Script
							 Version: 19.0.0.0 Build: 1
	Generated on:            2018-12-11 12:18:06

	Source Database:         ORCL11
	Source Database Version: 11.2.0.4.0
	For Upgrade to Version:  12.2.0.1.0
							  Fixup
	Check Name                Status  Further DBA Action
	----------                ------  ------------------
	em_present                Failed  Manual fixup recommended.
	amd_exists                Failed  Manual fixup recommended.
	dictionary_stats          Failed  Manual fixup recommended.
	trgowner_no_admndbtrg     Failed  Manual fixup recommended.
	mv_refresh                Failed  Manual fixup recommended.
	apex_upgrade_msg          Failed  Manual fixup recommended.

	PL/SQL procedure successfully completed.
	</code></pre><p>在此示例中，某些自动检查失败，并且需要手动修复。请参阅以下示例，了解如何执行手动修正。</p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-E86EC895-48D8-4164-850E-51EA35D2A3F3">
                     <p class="titleinexample">示例4-11手动删除Oracle企业管理器（em_present）</p>
                     <p><code>preupgrade_fixups.sql</code>日志文件为您提供了手动删除Oracle Enterprise Manager的说明（ <code class="codeph">em_present</code> ）：</p><pre class="pre codeblock"><code>+ Remove the EM repository.
		 
		 - Copy the rdbms/admin/emremove.sql script from the target 19.0.0.0.0
		 ORACLE_HOME into the source 11.2.0.4.0 ORACLE_HOME.
		 
		 Step 1: If database control is configured, stop EM Database Control,
		 using the following command
		 
		   $&gt; emctl stop dbconsole
		 
		 Step 2: Connect to the database using the SYS account AS SYSDBA
		 
		   SET ECHO ON;
		   SET SERVEROUTPUT ON;

		  @emremove.sql
		...
		...
		...
		
		Execution:
		
		Step 1 - Stop dbconsole:

			C:\app\oracle1\product\19\dbhome_1\rdbms\admin&gt; emctl stop dbconsole

			Oracle Enterprise Manager 11g Database Control Release 11.2.0.4.0
			Copyright (c) 1996, 2011 Oracle Corporation.  All rights reserved.
			https://db01.example.com:1158/em/console/aboutApplication
			The OracleDBConsoleorcl11 service is stopping...........
			The OracleDBConsoleorcl11 service was stopped successfully.
		
		Step 2 - Remove em (provide credentials if needed)

			...
			...
			...

			Dropping synonym : SETEMVIEWUSERCONTEXT ...
			Dropping synonym : SMP_EMD_AVAIL_OBJ ...
			Dropping synonym : SMP_EMD_DELETE_REC_ARRAY ...
			Dropping synonym : SMP_EMD_INTEGER_ARRAY ...
			Dropping synonym : SMP_EMD_INTEGER_ARRAY_ARRAY ...
			Dropping synonym : SMP_EMD_NVPAIR ...
			Dropping synonym : SMP_EMD_NVPAIR_ARRAY ...
			Dropping synonym : SMP_EMD_STRING_ARRAY ...
			Dropping synonym : SMP_EMD_STRING_ARRAY_ARRAY ...
			Dropping synonym : SMP_EMD_TARGET_OBJ ...
			Dropping synonym : SMP_EMD_TARGET_OBJ_ARRAY ...
			Finished phase 5
			Starting phase 6 : Dropping Oracle Enterprise Manager related other roles ...
			Finished phase 6
			The Oracle Enterprise Manager related schemas and objects are dropped.
			Do the manual steps to studown the DB Control if not done before running this
			script and then delete the DB Control configuration files

			PL/SQL procedure successfully completed.

			SQL&gt;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-D359CCB9-0775-49FF-BE36-788338AA92F9">
                     <p class="titleinexample">示例4-12手动删除OLAP目录（amd_exists）</p>
                     <p><code>preupgrade_fixups.sql</code>日志文件为您提供了手动删除OLAP目录的说明（ <code class="codeph">amd_exists</code> ）：</p><pre class="pre codeblock"><code> + Remove OLAP Catalog by running the 11.2.0.4.0 SQL script
     $ORACLE_HOME/olap/admin/catnoamd.sql script.  
     
     The OLAP Catalog component, AMD, exists in the database.
	 
	 sqlplus / as sysdba @%ORACLE_HOME%\olap\admin\catnoamd.sql
		...
		...
		...
	
		Synonym dropped.

		User dropped.

		Role dropped.

		SQL&gt;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-6D5B00B3-E74B-4AF8-BFBF-E48C1491783D">
                     <p class="titleinexample">示例4-13收集当前字典统计信息（dictionary_stats）</p>
                     <p><code>preupgrade_fixups.sql</code>日志文件为您提供了收集目录统计信息（ <code class="codeph">dictionary_stats</code> ）的说明。
                     </p><pre class="pre codeblock"><code>	   + Gather dictionary statistics prior to database upgrade in off-peak time
     using:
     
       EXECUTE dbms_stats.gather_dictionary_stats; 
	
		SQL&gt; EXECUTE dbms_stats.gather_dictionary_stats;

		PL/SQL procedure successfully completed.</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-74112031-EBB4-41E3-B51E-24099B6E0457">
                     <p class="titleinexample">示例4-14授予ADMINISTER DATABASE TRIGGER权限（trgowner_no_admndbtrg）</p>
                     <p><code>preupgrade_fixups.sql</code>日志文件为您提供授予ADMINISTER DATABASE TRIGGER权限（ <code class="codeph">trgowner_no_admndbtrg</code> ）的说明：</p><pre class="pre codeblock"><code>+ Directly grant ADMINISTER DATABASE TRIGGER privilege to the owner of the
		 trigger or drop and re-create the trigger with a user that was granted
		 directly with such. You can list those triggers using "SELECT OWNER,
		 TRIGGER_NAME FROM DBA_TRIGGERS WHERE BASE_OBJECT_TYPE='DATABASE' AND
		 OWNER NOT IN (SELECT GRANTEE FROM DBA_SYS_PRIVS WHERE
		 PRIVILEGE='ADMINISTER DATABASE TRIGGER')"  
	
			SQL&gt; SELECT OWNER,
			  2       TRIGGER_NAME FROM DBA_TRIGGERS WHERE BASE_OBJECT_TYPE='DATABASE' AND
			  3       OWNER NOT IN (SELECT GRANTEE FROM DBA_SYS_PRIVS WHERE
			  4       PRIVILEGE='ADMINISTER DATABASE TRIGGER');

			OWNER                          TRIGGER_NAME
			------------------------------ ------------------------------
			MDSYS                          SDO_DROP_USER
			MDSYS                          SDO_ST_SYN_CREATE
			MDSYS                          SDO_TOPO_DROP_FTBL
			MDSYS                          SDO_GEOR_BDDL_TRIGGER
			MDSYS                          SDO_GEOR_ADDL_TRIGGER
			MDSYS                          SDO_NETWORK_DROP_USER

			6 rows selected.

			SQL&gt; grant ADMINISTER DATABASE TRIGGER to MDSYS;

			Grant succeeded.	
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-33F66959-D631-4E8C-94AD-0CB74F7FE0EE">
                     <p class="titleinexample">示例4-15刷新实体化视图（mv_refresh）</p>
                     <p><code>preupgrade_fixups.sql</code>日志文件为您提供了刷新<code class="codeph">mv_refresh</code>化视图的指令（ <code class="codeph">mv_refresh</code> ）：</p><pre class="pre codeblock"><code>+ Please make sure that all the MVs are refreshed and sys.sumdelta$
		 becomes empty before doing upgrade, unless you have strong business
		 reasons not to do so. You can use dbms_mview.refresh() to refresh the
		 MVs except those stale ones  to be kept due to business need. If there
		 are any stale MVs depending on changes in sys.sumdelta$, do not truncate
		 it, because doing so will cause wrong results after refresh.   	
			 
			SQL&gt; declare
			  2  num_failures integer(3) :=0;
			  3  begin
			  4  DBMS_MVIEW.REFRESH_ALL_MVIEWS(num_failures,'C','', TRUE, FALSE);
			  5  end;
			  6  /

			PL/SQL procedure successfully completed.

			SQL&gt; select count(1) from sumdelta$;

			  COUNT(1)
			----------
					 0

			SQL&gt;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-FA801C45-2D70-4947-8A3F-1E620ACDE2D8">
                     <p class="titleinexample">示例4-16升级Oracle Application Express（apex_upgrade_msg）</p><code>preupgrade_fixups.sql</code>日志文件建议您可以升级Oracle Application Express（ <code class="codeph">apex_upgrade_msg</code> ）。运行此升级可以减少Oracle数据库升级所需的停机时间。日志文件为您提供有关如何完成升级的信息：<pre class="pre codeblock"><code>+ Consider upgrading APEX manually, before the database upgrade.  
		 
		 The database contains APEX version 3.2.1.00.12 and will need to be
		 upgraded to at least version 5.0.4.00.11.
		 
		 To reduce database upgrade time, you can upgrade APEX manually before
		 the database upgrade.  Refer to My Oracle Support Note 1088970.1 for
		 information on APEX installation upgrades.
	
		Download: http://www.oracle.com/technetwork/developer-tools/apex/downloads/index.html provide credentials.
		
		Then go to: http://www.oracle.com/technetwork/developer-tools/apex/application-express/upgrade-apex-for-xe-154969.html and
					https://docs.oracle.com/cd/E59726_01/install.50/e39144/toc.htm to guide you to do the upgrade.
					
		Once downloaded, please go to the directory and unzip the files, run the apex upgrade from there.
		
		...
		...
			Completing registration process. 12:07:41
			Validating installation.  12:07:41
			...Starting validation 12:07:41
			...Database user "SYS", database schema "APEX_050000", user# "90" 12:07:41
			...272 packages
			...265 package bodies
			...465 tables
			...8 functions
			...16 procedures
			...4 sequences
			...497 triggers
			...1582 indexes
			...255 views
			...0 libraries
			...14 types
			...5 type bodies
			...0 operators
			...0 index types
			...Begin key object existence check 12:07:53
			...Completed key object existence check 12:07:54
			...Setting DBMS Registry 12:07:54
			...Setting DBMS Registry Complete 12:07:54
			...Exiting validate 12:07:54

			PL/SQL procedure successfully completed.

			timing for: Validate Installation
			Elapsed: 00:00:13.00

			Session altered.

			timing for: Complete Installation
			Elapsed: 00:18:40.49
			
		...
		...
</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <div class="infoboxnote" id="GUID-6DCC7A57-7F82-467B-9B39-6568CEDF04BC__GUID-BAC905E7-96B6-4C68-9CFA-6D2385FC7CF0">
                        <p class="notep1">警告：</p>
                        <p>完成预升级步骤后，Oracle建议您在继续升级之前备份数据库。</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="backing-up-oracle-db-for-upgrading.html#GUID-E3BF972C-26EA-436D-B09B-716B3DB90A23">备份Oracle数据库以进行升级</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="example-manual-upgrade-windows-non-cdb-11203-to-122.html#GUID-30F3DC9C-141A-47DC-9B83-6D0C395E565C" title="这些示例显示了完成Oracle Database 11g第2版（11.2.0.4）升级到Oracle Database 19c的预升级检查，升级和升级后检查的步骤。">Windows非CDB Oracle数据库的手动升级示例</a></p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263" name="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263"></a><h3 id="UPGRD-GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263" class="sect3">使用命令行实用程序手动升级Windows非CDB</h3>
               <div>
                  <p>这些示例显示了将非CDB Oracle Database 11g第2版（11.2.0.4）升级到非CDB Oracle数据库的升级步骤</p>
                  <div class="section">
                     <p>完成预升级步骤后，可以将非CDB Oracle数据库升级到新版本的非CDB Oracle数据库。在开始升级之前，必须停止数据库服务。您可以使用命令行命令或使用Microsoft Windows PowerShell脚本来停止数据库服务。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="p">
                     <div class="p">完成升级的步骤顺序如下：<ol>
                           <li>
                              <p>使用命令行命令或PowerShell停止数据库服务。</p>
                           </li>
                           <li>
                              <p>从早期版本的Oracle主目录中删除数据库服务。</p>
                           </li>
                           <li>
                              <p>从早期版本的Oracle主目录中停止监听器</p>
                           </li>
                           <li>
                              <p>将环境变量设置为新的Oracle主目录。</p>
                           </li>
                           <li>
                              <p>将数据库文件（例如<code class="codeph">tnsnames.ora</code> ， <code class="codeph">listener.ora</code> ，密码文件，钱包和其他类似文件）复制到新的Oracle主目录。
                              </p>
                           </li>
                           <li>
                              <p>将PFILE复制到新的Oracle Database Oracle主目录，并使用新Oracle主目录中的Oracle Database二进制文件创建新服务。（在这个例子中，我们假设PFILE是兼容的。您的PFILE可能与新版本不兼容。）</p>
                           </li>
                           <li>
                              <p>开始数据库升级。</p>
                           </li>
                           <li>
                              <p>完成升级后的步骤。</p>
                           </li>
                        </ol>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-67BC2EB9-17A9-4DDC-9674-DECA196CC411">
                     <p class="titleinexample">示例4-17使用命令行命令停止数据库服务</p>
                     <ol>
                        <li>
                           <p>如果您不知道服务名称，请标识服务名称。</p><pre class="pre codeblock"><code>c:\apex\apex&gt;sc query type= service | find /i "orcl11"
				SERVICE_NAME: OracleServiceORCL11
				DISPLAY_NAME: OracleServiceORCL11
</code></pre></li>
                        <li>
                           <p>使用服务名称，找出服务的状态。</p><pre class="pre codeblock"><code>c:\apex\apex&gt;sc query  OracleServiceORCL11

				SERVICE_NAME: OracleServiceORCL11
					TYPE               : 10  WIN32_OWN_PROCESS
					STATE              : 4  RUNNING
											(STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)
					WIN32_EXIT_CODE    : 0  (0x0)
					SERVICE_EXIT_CODE  : 0  (0x0)
					CHECKPOINT         : 0x0
					WAIT_HINT          : 0x0
</code></pre></li>
                        <li>
                           <p>停止服务</p><pre class="pre codeblock"><code>c:\apex\apex&gt;sc stop  OracleServiceORCL11

				SERVICE_NAME: OracleServiceORCL11
					TYPE               : 10  WIN32_OWN_PROCESS
					STATE              : 3  STOP_PENDING
											(STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)
					WIN32_EXIT_CODE    : 0  (0x0)
					SERVICE_EXIT_CODE  : 0  (0x0)
					CHECKPOINT         : 0x5
					WAIT_HINT          : 0x15f90		
</code></pre></li>
                        <li>
                           <p>等待几分钟，然后检查状态。</p><pre class="pre codeblock"><code>c:\apex\apex&gt;sc query  OracleServiceORCL11

				SERVICE_NAME: OracleServiceORCL11
					TYPE               : 10  WIN32_OWN_PROCESS
					STATE              : 1  STOPPED
					WIN32_EXIT_CODE    : 0  (0x0)
					SERVICE_EXIT_CODE  : 0  (0x0)
					CHECKPOINT         : 0x0
					WAIT_HINT          : 0x0		</code></pre><p>服务停止后，您可以继续删除服务。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-457F4B48-3D74-401C-A8DB-F43739013BDE">
                     <p class="titleinexample">示例4-18使用Microsoft Windows PowerShell脚本停止数据库服务</p>
                     <ol>
                        <li>
                           <p>检查服务的状态。</p><pre class="pre codeblock"><code>PS C:\app\oraclbm\cfgtoollogs\orcl\preupgrade&gt; Get-Service | Where-Object {$_.displayName.Contains("ORCL11")}

				Status   Name               DisplayName
				------   ----               -----------
				Stopped  OracleJobSchedu... OracleJobSchedulerORCL11
				Running  OracleServiceOR... OracleServiceORCL11
				Running  OracleVssWriter... Oracle ORCL11 VSS Writer Service

</code></pre></li>
                        <li>
                           <p>停止服务。</p><pre class="pre codeblock"><code>PS C:\app\oraclbm\cfgtoollogs\orcl\preupgrade&gt; Get-Service | Where-Object {$_.displayName.Contains("ORCL11")} | Stop-Ser
				vice
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				WARNING: Waiting for service 'OracleServiceORCL11 (OracleServiceORCL11)' to stop...
				
</code></pre><p>服务停止后，您可以继续删除数据库服务。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-BFDFDC5E-3174-4DF2-B26D-8A545ED2219D">
                     <p class="titleinexample">示例4-19从早期版本Oracle Home中删除数据库服务</p>
                     <p>对于Windows上的Oracle Database 11g第2版（11.2.0.4），请使用早期版本的Oracle主目录中的ORADIM。ORADIM是一个特定于Windows的实用程序，可用于管理Windows服务。</p><pre class="pre codeblock"><code>c:\apex\apex&gt;oradim -delete -sid orcl11
			Unable to stop service, OS Error = 1062
			Instance deleted.
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-06C5AD07-2D00-43DA-8820-B641323B6C06">
                     <p class="titleinexample">示例4-20停止早期版本Oracle Home的监听器</p><pre class="pre codeblock"><code>c:\apex\apex&gt;lsnrctl status

			LSNRCTL for 64-bit Windows: Version 11.2.0.4.0 - Production on 13-JUL-2016 13:58:52

			Copyright (c) 1991, 2012, Oracle.  All rights reserved.

			Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1522)))
			STATUS of the LISTENER
			------------------------
			Alias                     LISTENER
			Version                   TNSLSNR for 64-bit Windows: Version 11.2.0.4.0 - Production
			Start Date                05-JUL-2018 10:01:30
			Uptime                    8 days 3 hr. 57 min. 23 sec
			Trace Level               off
			Security                  ON: Local OS Authentication
			SNMP                      OFF
			Listener Parameter File   C:\app\oracle2\product\11.2.0\dbhome_1\network\admin\listener.ora
			Listener Log File         C:\app\oracle2\diag\tnslsnr\slc01auu\listener\alert\log.xml
			Listening Endpoints Summary...
			  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(PIPENAME=\\.\pipe\EXTPROC1522ipc)))
			  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=db01.example.com)(PORT=1522)))
			Services Summary...
			Service "CLRExtProc" has 1 instance(s).
			  Instance "CLRExtProc", status UNKNOWN, has 1 handler(s) for this service...
			The command completed successfully

c:\apex\apex&gt;lsnrctl stop

			LSNRCTL for 64-bit Windows: Version 11.2.0.4.0 - Production on 13-JUL-2018 13:59:00

			Copyright (c) 1991, 2012, Oracle.  All rights reserved.

			Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1522)))
			The command completed successfully	</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-3E16E129-133D-4E01-835F-EC46F24BF1DF">
                     <p class="titleinexample">示例4-21将环境变量设置为新的Oracle主目录</p><pre class="pre codeblock"><code>c:\apex\apex&gt;set ORACLE_HOME=C:\app\oracle1\product\18.1.0\dbhome_1

c:\apex\apex&gt;SET PATH=%ORACLE_HOME%\BIN;%PATH%

c:\apex\apex&gt;SET ORACLE_SID=ORCL11	</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-F246D222-945F-4665-A522-6B5EEC35C401">
                     <p class="titleinexample">示例4-22将PFILE复制到新的Oracle主目录，并使用新的Oracle数据库二进制文件创建新服务</p>
                     <p>此示例显示如何使用特定于Windows的ORADIM实用程序来创建新的数据库服务。在此示例中，早期版本的PFILE与新版本兼容。</p><pre class="pre codeblock"><code>c:\apex\apex&gt;C:\app\oracle1\product\18.1.0\dbhome_1\bin\oradim -new -sid orcl11 -syspwd 
<span class="variable" translate="no">My-sys-password</span> -maxusers 1000 -startmode auto -pfile  C:\app\oracle1\product\18.1.0\dbhome_1\database\initorcl11.ora

			Enter password for Oracle service user:
			Instance created.
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-E65164EA-E14A-4AD7-B8CD-D6E5E8ECBF8E">
                     <p class="titleinexample">示例4-23启动数据库升级</p>
                     <p>使用Parallel Upgrade Utility开始升级。</p>
                     <div class="infoboxnote" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-81A8815A-5E57-4E67-975F-FF7634D8A0E4">
                        <p class="notep1">注意：</p>
                        <p>您可以发现必须更改PFILE上的文件夹符号链接以用于DIAGNOSTIC_DEST等路径。如果是这种情况，那么您会看到以下示例中的错误：</p><pre class="pre codeblock"><code>ORA-48173: error checking directory existence during ADR initialization [C:\app\oracle2\diag\rdbms\orcl11]
ORA-00205: error in identifying control file, check alert log for more info
</code></pre><p>如果您看到这些错误，则在早期版本的Oracle主目录上以及具有继承的所有相关文件夹上向用户授予权限。在数据库访问的任何访问控制列表（ACL）上也进行此更改，例如钱包文件。如果您使用早期版本的Oracle主目录作为ORADATA位置，则此步骤尤为必要。</p>
                     </div>
                     <p>如果您使用的是内置帐户，则该服务将作为<code class="codeph">LocalSystem</code>运行。如果您使用的是虚拟帐户，则使用Windows虚拟帐户运行服务，其名称来自服务名称。如果Oracle Database 19c二进制文件所有者是虚拟帐户，则必须将该虚拟帐户添加到组<code class="codeph">ORA_ <span class="variable" translate="no">Homename</span> _SVCAACCTS</code> ，而不是添加Oracle Home User。
                     </p>
                     <p>Oracle Database 19c包含一个shell脚本<code class="codeph">dbupgrade</code> 。shell脚本调用并行升级实用程序（ <code class="codeph">catctl.pl</code> ），以便您可以将升级作为命令运行。此示例显示Oracle数据库从版本11.2.0.4升级到版本19c。系统的升级时间可能与此示例中的结果不同。
                     </p><pre class="pre codeblock"><code>C:\app\oracle1\product\19.1.0\dbhome_1\bin&gt;dbupgrade 
			...
			...
			...
				C:\app\oracle1\product\19.1.0\dbhome_1\bin&gt;REM Batch file to execute catctl.pl

				Argument list for [C:\app\oracle1\product\19\dbhome_1\rdbms\admin\catctl.pl]
				Run in                c = 0
				Do not run in         C = 0
				Input Directory       d = 0
				Echo OFF              e = 1
				Simulate              E = 0
				Forced cleanup        F = 0
				Log Id                i = 0
				Child Process         I = 0
				Log Dir               l = c:\temp2
				Priority List Name    L = 0
				Upgrade Mode active   M = 0
				SQL Process Count     n = 4
				SQL PDB Process Count N = 0
				Open Mode Normal      o = 0
				Start Phase           p = 0
				End Phase             P = 0
				Reverse Order         r = 0
				AutoUpgrade Resume    R = 0
				Script                s = 0
				Serial Run            S = 0
				RO User Tablespaces   T = 0
				Display Phases        y = 0
				Debug catcon.pm       z = 0
				Debug catctl.pl       Z = 0

				catctl.pl VERSION: [19.0.0.0.0]
                    STATUS: [production]
                    BUILD: [RDBMS_MAIN_WINDOWS.X64_160624]


				C:\app\oracle1\product\19.1.0\dbhome_1\rdbms\admin\orahome.exe = [C:\app\oracle1\product\19.1.0\dbhome_1]
				C:\app\oracle1\product\19.1.0\dbhome_1\bin\orabasehome.exe = [C:\app\oracle1\product\189.1.0\dbhome_1]
				catctlGetOrabase = [C:\app\oracle1\product\19.1.0\dbhome_1]

				Analyzing file C:\app\oracle1\product\19.1.0\dbhome_1\rdbms\admin\catupgrd.sql

				Log file directory = [c:\temp2]

				catcon: ALL catcon-related output will be written to [c:\temp2/catupgrd_catcon_3252.lst]
				catcon: See [c:\temp2/catupgrd*.log] files for output generated by scripts
				catcon: See [c:\temp2/catupgrd_*.lst] files for spool files, if any

				Number of Cpus        = 2
				Database Name         = orcl11
				DataBase Version      = 11.2.0.4.0
				Parallel SQL Process Count            = 4
				Components in [orcl11]
					Installed [APEX APS CATALOG CATJAVA CATPROC CONTEXT JAVAVM ORDIM OWM SDO XDB XML XOQ]
				Not Installed [DV EM MGW ODM OLS RAC WK]

				------------------------------------------------------
				Phases [0-109]         Start Time:[2018_12_13 15:49:40]
				------------------------------------------------------
				***********   Executing Change Scripts   ***********
				Serial   Phase #:0    [orcl11] Files:1			

			...
			...
			...
				------------------------------------------------------
				Phases [0-109]         End Time:[2018_12_13 16:53:27]
				------------------------------------------------------

				Grand Total Time: 3830s

				 LOG FILES: (c:\temp2\catupgrd*.log)

				Upgrade Summary Report Located in:
				c:\temp2\upg_summary.log

				Grand Total Upgrade Time:    [0d:1h:3m:50s]</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-BCD5E0B2-B821-435E-93E8-B033A65DA263__GUID-FA5F8742-199D-465A-A81D-30E57E889B55">
                     <p class="titleinexample">示例4-24完成升级后检查</p>
                     <p>启动升级的Oracle数据库，并检查版本和状态。</p><pre class="pre codeblock"><code>C:\app\oracle1\product\19.1.0\dbhome_1\bin&gt;sqlplus / as sysdba

				SQL*Plus: Release 19.1.0 Production on Thu Dec 13 09:38:50 201

				Copyright (c) 1982, 2019, Oracle.  All rights reserved.

				Connected to an idle instance.

				SQL&gt; startup
				ORACLE instance started.

				Total System Global Area 1828716544 bytes
				Fixed Size                  8740096 bytes
				Variable Size             503317248 bytes
				Database Buffers         1308622848 bytes
				Redo Buffers                8036352 bytes
				Database mounted.
				Database opened.
				SQL&gt; select open_mode from v$database;

				OPEN_MODE
				--------------------
				READ WRITE

				SQL&gt; select version from v$instance;

				VERSION
				-----------------
				19.0.0.0.0

				SQL&gt;			</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>升级完成后，执行升级后检查以确保对象有效，并且没有剩余问题。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="example-manual-upgrade-windows-non-cdb-11203-to-122.html#GUID-30F3DC9C-141A-47DC-9B83-6D0C395E565C" title="这些示例显示了完成Oracle Database 11g第2版（11.2.0.4）升级到Oracle Database 19c的预升级检查，升级和升级后检查的步骤。">Windows非CDB Oracle数据库的手动升级示例</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-B5A840F4-912B-4DAD-82CA-94522140DB14" name="GUID-B5A840F4-912B-4DAD-82CA-94522140DB14"></a><h3 id="UPGRD-GUID-B5A840F4-912B-4DAD-82CA-94522140DB14" class="sect3">升级非CDB数据库后运行Postupgrade修复脚本</h3>
               <div>
                  <p>这些示例显示了为非CDB升级到非CDB升级的<code>postupgrade_fixups.sql</code>脚本的过程。
                  </p>
                  <div class="section">
                     <p>这些示例显示从非CDB Oracle Database 11g第2版（11.2.0.4）升级到非CDB Oracle数据库19c。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-B5A840F4-912B-4DAD-82CA-94522140DB14__GUID-78192807-06CA-41FD-AAB1-17E6824F28F8">
                     <p class="titleinexample">示例4-25运行Postupgrade Fixups脚本</p>
                     <p>在开始升级之前，运行先前版本Oracle主目录中使用升级前信息工具生成的<code>postupgrade_fixups.sql</code>脚本：</p><pre class="pre codeblock"><code>SQL&gt; @C:\app\oracle\cfgtoollogs\orcl11\preupgrade\postupgrade_fixups.sql

                  SQL&gt; REM

                  SQL&gt; REM    Oracle POST-Upgrade Fixup Script

                  SQL&gt; REM

                  SQL&gt; REM    Auto-Generated by: Oracle Preupgrade Script

                  SQL&gt; REM    Version: 19.0.0.0.0

                  SQL&gt; REM    Generated on:            2018-12-05 12:18:07

                  SQL&gt; REM

                  SQL&gt; REM    Source Database:         ORCL11

                  SQL&gt; REM    Source Database Version: 11.2.0.4.0

                  SQL&gt; REM    For Upgrade to Version:    19.0.0.0.0

                  SQL&gt; REM

                  SQL&gt;

                  SQL&gt; REM

                  SQL&gt; REM    Setup Environment

                  SQL&gt; REM

                  SQL&gt; SET ECHO OFF SERVEROUTPUT ON FORMAT WRAPPED TAB OFF LINESIZE 200;

                  Executing Oracle POST-Upgrade Fixup Script

                  Auto-Generated by:       Oracle Preupgrade Script

         Version: 19.0.0.0.0

                  Generated on:            2018-12-05 12:18:07

 

                  Source Database:         ORCL11

                  Source Database Version: 11.2.0.4.0

                  For Upgrade to Version:  19.0.0.0.0

         Fixup

                     Check Name                Status  Further DBA Action

                     ----------                ------  ------------------

                     depend_usr_tables         Failed  Manual fixup recommended.

                     old_time_zones_exist      Failed  Manual fixup recommended.

                     post_dictionary           Failed  Manual fixup recommended.

                     fixed_objects             Passed  None

                     upg_by_std_upgrd          Passed  None

                     PL/SQL procedure successfully completed.

                     Elapsed: 00:00:11.26

 SQL&gt;      </code></pre><p>在此示例中， <code>postupgrade_fixup.sql</code>脚本无法完成三个修复。所以你被指示进行手动修正。这个结果很正常。要执行手动修复，请查看日志文件<code class="codeph">preupgrade.log</code> 。它包含有关如何运行手动修复脚本的说明和脚本信息。这些<code>postupgrade_fixups.sql</code>脚本由<code>postupgrade_fixups.sql</code>脚本为您生成。按照日志文件中提供的说明解决问题。
                     </p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-B5A840F4-912B-4DAD-82CA-94522140DB14__GUID-6FA77187-D5F7-4036-836C-708E4A616D48">
                     <p class="titleinexample">示例4-26用户表中Oracle维护类型的手动修复指令（depend_usr_tables）</p><pre class="pre codeblock"><code>    + If you use the -T option for the database upgrade, then run

                    @?/rdbms/admin/utluptabdata.sql after the upgrade is complete, to

                    VALIDATE and UPGRADE any user tables affected by changes to

                    Oracle-Maintained types.                                                          
                                              

  SQL&gt; @C:\app\oracle\product\19.1.0\dbhome_1\rdbms\admin\utluptabdata.sql

  PL/SQL procedure successfully completed.

                    SQL&gt;
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-B5A840F4-912B-4DAD-82CA-94522140DB14__GUID-0BC6C7B9-7295-4D5C-91C7-3425624C4ED8">
                     <p class="titleinexample">示例4-27时区版本的手动修复说明（old_time_zones_exist）</p><pre class="pre codeblock"><code>+ Upgrade the database time zone version using the DBMS_DST package. 


                   The database is using timezone datafile version 14 and the target

                   19.0.0.0.0 database ships with timezone datafile version 26.

                   Oracle recommends using the most recent timezone data.  For further

                   information, refer to My Oracle Support Note 1585343.1
                                           

                   SQL&gt; @C:\Users\oracle\Downloads\DBMS_DST_scriptsV1.9\DBMS_DST_scriptsV1.9\countstatsTSTZ.sql

                   .

                   Amount of TSTZ data using num_rows stats info in DBA_TABLES.

                   .

                   For SYS tables first...

                   Note: empty tables are not listed.

                   Stat date  - Owner.Tablename.Columnname - num_rows

                   05/07/2019 - SYS.AQ$_ALERT_QT_S.CREATION_TIME - 5

                   ...


                   Total numrow of SYS TSTZ columns is : 14652

                   There are in total 154 non-SYS TSTZ columns.

                   .

                   ...

                   For non-SYS tables ...

                   Note: empty tables are not listed.

                   ...

                   ...

                   Stat date  - Owner.Tablename.Columnname - num_rows

                   Total numrow of non-SYS TSTZ columns is : 17

                   There are in total 32 non-SYS TSTZ columns.

                   Total Minutes elapsed : 0

                   SQL&gt;                                                     

                   SQL&gt; spool upg_tzv_check.log

                   SQL&gt; @C:\Users\oracle\Downloads\DBMS_DST_scriptsV1.9\DBMS_DST_scriptsV1.9\upg_tzv_check.sql

                   INFO: Starting with RDBMS DST update preparation.

                   INFO: NO actual RDBMS DST update will be done by this script.

                   INFO: If an ERROR occurs the script will EXIT sqlplus.

                   INFO: Doing checks for known issues ...

                   INFO: Database version is 19.0.0.0.0 .

                   INFO: Database RDBMS DST version is DSTv14 .

                   INFO: No known issues detected.

                   INFO: Now detecting new RDBMS DST version.

                   A prepare window has been successfully started.

                   INFO: Newest RDBMS DST version detected is DSTv26 .

                   INFO: Next step is checking all TSTZ data.

                   INFO: It might take a while before any further output is seen ...

                   A prepare window has been successfully ended.

                   INFO: A newer RDBMS DST version than the one currently used is found.

                   INFO: Note that NO DST update was yet done.

                   INFO: Now run upg_tzv_apply.sql to do the actual RDBMS DST update.

                   INFO: Note that the upg_tzv_apply.sql script will

                   INFO: restart the database 2 times WITHOUT any confirmation or prompt.

                   SQL&gt; spool off                                                                                  

                   SQL&gt; @C:\Users\oracle\Downloads\DBMS_DST_scriptsV1.9\DBMS_DST_scriptsV1.9\upg_tzv_apply.sql

                   INFO: If an ERROR occurs the script will EXIT sqlplus.

                   INFO: The database RDBMS DST version will be updated to DSTv26 .

                   WARNING: This script will restart the database 2 times

                   WARNING: WITHOUT asking ANY confirmation.

                   WARNING: Hit control-c NOW if this is not intended.

                   INFO: Restarting the database in UPGRADE mode to start the DST upgrade.

                   Database closed.

                   Database dismounted.  &lt;--------- you might need to wait a couple of minutes and hit enter a couple of times.           

                   ORACLE instance shut down.

                   ORACLE instance started.


                  Total System Global Area 1828716544 bytes

                  Fixed Size                  8740096 bytes

                  Variable Size             503317248 bytes

                  Database Buffers         1308622848 bytes

                  Redo Buffers                8036352 bytes

                  Database mounted.

                  Database opened.

                  INFO: Starting the RDBMS DST upgrade.

                  INFO: Upgrading all SYS owned TSTZ data.

                  INFO: It might take time before any further output is seen ... &lt;--------- you might need to wait a couple of minutes
                  and hit enter a couple of times.               

                  An upgrade window has been successfully started.

                  INFO: Restarting the database in NORMAL mode to upgrade non-SYS TSTZ data.

                  Database closed.

                  Database dismounted.

                  ORACLE instance shut down.

                  ORACLE instance started. 


                  Total System Global Area 1828716544 bytes

                  Fixed Size                  8740096 bytes

                  Variable Size             503317248 bytes

                  Database Buffers         1308622848 bytes

                  Redo Buffers                8036352 bytes

                  Database mounted.

                  Database opened.   ... &lt;--------- you might need to wait a couple of minutes and hit enter a couple of times.

                  INFO: Upgrading all non-SYS TSTZ data.

                  INFO: It might take time before any further output is seen ...

                  INFO: Do NOT start any application yet that uses TSTZ data! ... &lt;--------- you might need to wait a couple of minutes
                  and hit enter a couple of times.               

                  INFO: Next is a list of all upgraded tables:

                  Table list: "IX"."AQ$_ORDERS_QUEUETABLE_L"

                  Number of failures: 0

                  Table list: "IX"."AQ$_ORDERS_QUEUETABLE_S"

                  Number of failures: 0

                  Table list: "IX"."AQ$_STREAMS_QUEUE_TABLE_L"

                  Number of failures: 0

                  Table list: "IX"."AQ$_STREAMS_QUEUE_TABLE_S"

                  Number of failures: 0

                  Table list: "APEX_050000"."WWV_FLOW_DEBUG_MESSAGES"

                  Number of failures: 0

                  Table list: "APEX_050000"."WWV_FLOW_DEBUG_MESSAGES2"

                  Number of failures: 0

                  Table list: "APEX_050000"."WWV_FLOW_FEEDBACK"

                  Number of failures: 0

                  Table list: "APEX_050000"."WWV_FLOW_FEEDBACK_FOLLOWUP"

                  Number of failures: 0

                  Table list: "APEX_050000"."WWV_FLOW_WORKSHEET_NOTIFY"

                  Number of failures: 0

                  Table list: "GSMADMIN_INTERNAL"."AQ$_CHANGE_LOG_QUEUE_TABLE_L"

                  Number of failures: 0

                  Table list: "GSMADMIN_INTERNAL"."AQ$_CHANGE_LOG_QUEUE_TABLE_S"

                  Number of failures: 0

                  INFO: Total failures during update of TSTZ data: 0 .

                  An upgrade window has been successfully ended.

                  INFO: Your new Server RDBMS DST version is DSTv26 .

                  INFO: The RDBMS DST update is successfully finished.

                  INFO: Make sure to exit this sqlplus session.

                  INFO: Do not use it for timezone related selects.

            SQL&gt;     

                                                </code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-B5A840F4-912B-4DAD-82CA-94522140DB14__GUID-7D2CCA90-9EE1-44A8-B3E4-B395653D4E8D">
                     <p class="titleinexample">示例4-28刷新字典统计信息的手动修复（post_dictionary）</p><pre class="pre codeblock"><code>+ Gather dictionary statistics after the upgrade using the command:

                 EXECUTE DBMS_STATS.GATHER_DICTIONARY_STATS; 

                 This recommendation is given for all preupgrade runs.                 

         SQL&gt; EXECUTE DBMS_STATS.GATHER_DICTIONARY_STATS;

         PL/SQL procedure successfully completed.

 
         SQL&gt;                                                                                     
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="example-manual-upgrade-windows-non-cdb-11203-to-122.html#GUID-30F3DC9C-141A-47DC-9B83-6D0C395E565C" title="这些示例显示了完成Oracle Database 11g第2版（11.2.0.4）升级到Oracle Database 19c的预升级检查，升级和升级后检查的步骤。">Windows非CDB Oracle数据库的手动升级示例</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>