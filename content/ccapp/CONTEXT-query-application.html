<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>上下文查询应用程序</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Application Developer&#39;s Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Application Developer&#39;s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="text-application-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-07T01:45:16-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96275-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="migrating-oracle-text-applications.html" title="Previous" type="text/html">
      <link rel="next" href="CATSEARCH-query-application.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Text Application Developer&#39;s Guide">
    <meta name="dcterms.isVersionOf" content="CCAPP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="migrating-oracle-text-applications.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="CATSEARCH-query-application.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">应用程序开发人员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">上下文查询应用程序</li>
            </ol>
            <a id="GUID-1F1B44E8-ACCA-446A-84EA-67FA692476BA" name="GUID-1F1B44E8-ACCA-446A-84EA-67FA692476BA"></a><a id="CCAPP3000"></a>
            
            <h2 id="CCAPP-GUID-1F1B44E8-ACCA-446A-84EA-67FA692476BA" class="sect2"><span class="enumeration_chapter">上下文</span>查询应用</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d40230e61" class="indexterm-anchor"></a><a id="d40230e65" class="indexterm-anchor"></a><a id="d40230e67" class="indexterm-anchor"></a><a id="d40230e71" class="indexterm-anchor"></a>本附录介绍如何使用<code class="codeph">CONTEXT</code>索引类型构建简单的Web搜索应用程序。
               </p>
               <p>本附录包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE">Web查询应用程序概述</a></p>
                  </li>
                  <li>
                     <p><a href="CONTEXT-query-application.html#GUID-02600A05-F136-464F-A683-0504F6809388">PL / SQL Server页面（PSP）Web应用程序</a></p>
                  </li>
                  <li>
                     <p><a href="CONTEXT-query-application.html#GUID-DEABF1DC-7C2E-436D-A83F-D036260B0B32">Java Server Pages（JSP）Web应用程序</a></p>
                  </li>
               </ul>
            </div><a id="CCAPP9528"></a><a id="CCAPP9529"></a><a id="CCAPP9371"></a><div class="props_rev_3"><a id="GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE" name="GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE"></a><h3 id="CCAPP-GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE" class="sect3"><span class="enumeration_section">A.1</span> Web查询应用程序概述</h3>
               <div>
                  <p>Oracle Text的一个常见用途是为网站上的HTML文件编制索引，并为用户提供搜索功能。本附录中的示例应用程序对存储在数据库中的一组HTML文件进行索引。它还使用连接到Oracle数据库的Web服务器来提供搜索服务。</p>
                  <p>本附录描述了Web查询应用程序的两个版本：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>一个使用PL / SQL Server Pages（ <span class="bold">PSP</span> ）</p>
                     </li>
                     <li>
                        <p>一个使用Java Server Pages（ <span class="bold">JSP</span> ）</p>
                     </li>
                  </ul>
                  <p><a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDIHHGG">图A-1</a>显示了文本查询应用程序的JSP版本。
                  </p>
                  <div class="figure" id="GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDIHHGG">
                     <p class="titleinfigure">图A-1文本查询应用程序</p><img src="img/search01b.png" width="557" alt="下面是图A-1的描述" title="下面是图A-1的描述" longdesc="img_text/search01b.html"><br><a href="img_text/search01b.html">“图A-1文本查询应用程序”的描述</a></div>
                  <!-- class="figure" -->
                  <p><a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDGCBIC">图A-2</a>显示了文本查询的结果。
                  </p>
                  <div class="figure" id="GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDGCBIC">
                     <p class="titleinfigure">图A-2带结果的文本查询应用程序</p><img src="img/search02b.png" width="557" alt="下面是图A-2的描述" title="下面是图A-2的描述" longdesc="img_text/search02b.html"><br><a href="img_text/search02b.html">“图A-2带结果的文本查询应用程序”的描述</a></div>
                  <!-- class="figure" -->
                  <p>应用程序返回包含搜索词的文档的链接。每个文档都有四个链接：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="bold">HTML</span>链接显示文档。
                        </p>
                        <p>图形不会显示在已过滤的文档中。</p>
                     </li>
                     <li>
                        <p><span class="bold">突出显示</span>链接显示<span class="bold">突出</span>显示搜索词的文档。
                        </p>
                     </li>
                     <li>
                        <p><span class="bold">主题</span>链接显示与文档关联的前50个主题。
                        </p>
                        <p><span class="bold">Gist</span>链接显示文档的简短摘要。
                        </p>
                     </li>
                  </ul>
               </div>
            </div><a id="CCAPP9530"></a><a id="CCAPP9372"></a><div class="props_rev_3"><a id="GUID-02600A05-F136-464F-A683-0504F6809388" name="GUID-02600A05-F136-464F-A683-0504F6809388"></a><h3 id="CCAPP-GUID-02600A05-F136-464F-A683-0504F6809388" class="sect3"><span class="enumeration_section">A.2</span> PL / SQL Server页面（PSP）Web应用程序</h3>
               <div>
                  <p>PSP Web应用程序基于PL / SQL服务器页面。<a href="CONTEXT-query-application.html#GUID-02600A05-F136-464F-A683-0504F6809388__CACJEDFE">图A-3</a>说明了浏览器如何通过Web服务器调用Oracle数据库上的PSP存储过程。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8">PSP Web应用程序先决条件</a></p>
                     </li>
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B">构建PSP Web应用程序</a></p>
                     </li>
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-5399C5D7-77E6-4BD9-AAD8-21D63279E630">PSP Web应用程序示例代码</a></p>
                     </li>
                  </ul>
                  <div class="figure" id="GUID-02600A05-F136-464F-A683-0504F6809388__CACJEDFE">
                     <p class="titleinfigure">图A-3 PSP Web应用程序</p><img src="img/ccapp012.gif" width="596" alt="下面是图A-3的描述" title="下面是图A-3的描述" longdesc="img_text/ccapp012.html"><br><a href="img_text/ccapp012.html">“图A-3 PSP Web应用程序”的描述</a></div>
                  <!-- class="figure" -->
               </div><a id="CCAPP9373"></a><div class="props_rev_3"><a id="GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8" name="GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8"></a><h4 id="CCAPP-GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8" class="sect4"><span class="enumeration_section">A.2.1</span> PSP Web应用程序先决条件</h4>
                  <div>
                     <p>此应用程序具有以下要求：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您的Oracle数据库必须已启动并正在运行。</p>
                        </li>
                        <li>
                           <p>您解锁SCOTT帐户时使用其密码解锁，该帐户具有<code class="codeph">CREATE,</code> <code class="codeph">RESOURCE,</code>和<code class="codeph">CTXAPP</code>权限。
                           </p>
                        </li>
                        <li>
                           <p>Oracle PL / SQL网关必须正在运行。</p>
                        </li>
                        <li>
                           <p>Apache等Web服务器已启动并正在运行，并且已正确配置为向Oracle数据库发送请求。</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8__GUID-A6C42CA6-B81B-45E8-AB98-D34D38E601BB">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../jsqlj/key-programming-considerations.html#JSQLJ196" target="_blank"><span class="italic">Oracle数据库SQLJ开发人员指南，</span></a>用于连接示例</p>
                           </li>
                           <li>
                              <p>有关设置PL / SQL网关和开发PL / SQL Web应用程序的完整信息，请参见<a href="../adfns/web-applications.html#ADFNS015" target="_blank"><span class="italic">“Oracle数据库开发指南”</span></a></p>
                           </li>
                           <li>
                              <p>有关安装Apache HTTP Server的信息，请参阅<span class="italic">Oracle Database 2 Day + PHP Developer's Guide</span></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="CCAPP9374"></a><div class="props_rev_3"><a id="GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B" name="GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B"></a><h4 id="CCAPP-GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B" class="sect4"><span class="enumeration_section">A.2.2</span>构建PSP Web应用程序</h4>
                  <div>
                     <div class="section">
                        <p>要创建PSP Web应用程序：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>创建文本表。</span><div>
                              <p>必须使用<code class="codeph">CREATE</code> <code class="codeph">TABLE</code>命令创建文本表以存储HTML文件。这些示例创建<code class="codeph">output_table,</code> <code class="codeph">gist_table,</code>和<code class="codeph">theme_table</code>表：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE output_table  (query_id NUMBER, document CLOB);
CREATE TABLE gist_table  (query_id NUMBER, pov VARCHAR2(80), gist CLOB);
CREATE TABLE theme_table  (query_id NUMBER, theme VARCHAR2(2000), weight NUMBER);
</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用SQL * Loader将HTML文档加载到表中。</span><div>
                              <p>您必须使用HTML文件加载文本表。此示例使用<a href="CONTEXT-query-application.html#GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9">loader.ctl</a>控制文件来加载在<a href="CONTEXT-query-application.html#GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6">loader.dat中</a>指定的文件。SQL * Loader语句如下：</p><pre class="oac_no_warn" dir="ltr">% sqlldr userid=scott/<span class="italic">password</span> control=loader.ctl 
</pre></div>
                        </li>
                        <li class="stepexpand"><span>创建<code class="codeph">CONTEXT</code>索引。<a id="d40230e553" class="indexterm-anchor"></a><a id="d40230e557" class="indexterm-anchor"></a><a id="d40230e561" class="indexterm-anchor"></a><a id="d40230e565" class="indexterm-anchor"></a></span><div>
                              <p>通过在文本列上创建<code class="codeph">CONTEXT</code>索引来索引HTML文件，如下所示。因为您正在索引HTML，所以此示例使用<code class="codeph">NULL_FILTER</code>首选项类型进行无过滤，并使用<code class="codeph">HTML_SECTION_GROUP</code>类型，如下所示：</p><pre class="oac_no_warn" dir="ltr">create index idx_search_table on search_table(text)
  indextype is ctxsys.context parameters
  ('filter ctxsys.null_filter section group CTXSYS.HTML_SECTION_GROUP');
</pre></div>
                        </li>
                        <li class="stepexpand"><span>编译Oracle数据库中的<code class="codeph">search_htmlservices</code>包。</span><div>
                              <p>应用程序必须向用户显示所选文档。为此，Oracle数据库必须从<code class="codeph">search_table</code>的字符大对象<code class="codeph">(CLOB)</code>读取文档并输出结果以供查看。为此，请调用<code class="codeph">search_htmlservices</code>包中的过程。在SQL * Plus提示符下编译文件<a href="CONTEXT-query-application.html#GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092">search_htmlservices.sql</a>文件，如下所示：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; @search_htmlservices.sql

Package created.
</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">search_html</code>编译<code class="codeph">search_html</code> PSP页面。</span><div>
                              <p>通过从浏览器调用<a href="CONTEXT-query-application.html#GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80">search_html.psp</a>来调用搜索页面。您可以使用<code class="codeph">loadpsp</code>命令行程序在Oracle数据库中编译search_html，如下所示：</p><pre class="oac_no_warn" dir="ltr">% loadpsp -replace -user scott/<span class="italic">password</span> search_html.psp
</pre><p>输出显示为：</p><pre class="oac_no_warn" dir="ltr">"search_html.psp": procedure "search_html" created.</pre><div class="infoboxnotealso" id="GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B__GUID-0F0008F6-A5EC-4701-B3B4-7A95072258D8">
                                 <p class="notep1">也可以看看：</p>
                                 <p>有关使用PSP的更多信息，请参见“Oracle数据库开发指南”的Oracle Database 11g第2版（11.2）</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>配置Web服务器。</span><div>
                              <p>您必须将Web服务器配置为接受客户端PSP请求作为URL。您的Web服务器将这些请求转发到Oracle数据库并将服务器输出返回给浏览器。<a href="CONTEXT-query-application.html#GUID-02600A05-F136-464F-A683-0504F6809388__CACJEDFE">见图A-3</a> 。
                              </p>
                              <p>您可以使用Oracle WebDB Web侦听器或Oracle Application Server，其中包括Apache Web服务器。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>从浏览器输入查询。</span><div>
                              <p>您可以使用URL从浏览器访问查询应用程序。您使用Web服务器配置URL。示例URL可能如下所示：</p><pre class="oac_no_warn" dir="ltr">http://server.example.com:7777/mypath/search_html
</pre><p>应用程序在浏览器中显示一个查询输入框，并将查询结果作为HTML链接列表返回， <a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDIHHGG">如图A-1</a>和<a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDGCBIC">图A-2所示</a> 。
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="CCAPP9375"></a><div class="props_rev_3"><a id="GUID-5399C5D7-77E6-4BD9-AAD8-21D63279E630" name="GUID-5399C5D7-77E6-4BD9-AAD8-21D63279E630"></a><h4 id="CCAPP-GUID-5399C5D7-77E6-4BD9-AAD8-21D63279E630" class="sect4"><span class="enumeration_section">A.2.3</span> PSP Web应用程序示例代码</h4>
                  <div>
                     <p>本节列出了用于构建示例Web应用程序的代码。它包括以下文件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="CONTEXT-query-application.html#GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9">loader.ctl</a></p>
                        </li>
                        <li>
                           <p><a href="CONTEXT-query-application.html#GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6">loader.dat</a></p>
                        </li>
                        <li>
                           <p><a href="CONTEXT-query-application.html#GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092">search_htmlservices.sql</a></p>
                        </li>
                        <li>
                           <p><a href="CONTEXT-query-application.html#GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80">search_html.psp</a></p>
                        </li>
                     </ul>
                  </div><a id="CCAPP9376"></a><div class="props_rev_3"><a id="GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9" name="GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9"></a><h5 id="CCAPP-GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9" class="sect5"><span class="enumeration_section">A.2.3.1</span> loader.ctl</h5>
                     <div>
                        <div class="section">
                           <p>此示例显示了一个示例<code class="codeph">loader.ctl</code>文件。<code class="codeph">sqlldr</code>使用它来加载<code class="codeph">loader.dat</code>数据文件。
                           </p><pre class="oac_no_warn" dir="ltr">LOAD DATA 
        INFILE 'loader.dat'
        INTO TABLE search_table 
        REPLACE 
        FIELDS TERMINATED BY ';'
        (tk             INTEGER,
         title          CHAR,
         text_file      FILLER CHAR,
         text           LOBFILE(text_file) TERMINATED BY EOF)</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9377"></a><div class="props_rev_3"><a id="GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6" name="GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6"></a><h5 id="CCAPP-GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6" class="sect5"><span class="enumeration_section">A.2.3.2</span> loader.dat</h5>
                     <div>
                        <div class="section">
                           <p>此示例显示了一个示例<code class="codeph">loader.dat</code>文件。每行包含三个字段：文档的引用号，标签（或“标题”），以及要加载到<code class="codeph">search_table.</code>的文本列中的HTML文档的名称<code class="codeph">search_table.</code> 该示例已截断该文件。
                           </p><pre class="oac_no_warn" dir="ltr">1;   Pizza Shredder;Pizza.html
2;   Refrigerator w/ Front-Door Auto Cantaloupe Dispenser;Cantaloupe.html
3;   Self-Tipping Couch;Couch.html
4;   Home Air Dirtier;Mess.html
5;   Set of Pet Magnets;Pet.html
6;   Esteem-Building Talking Pillow;Snooze.html</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9668"></a><a id="CCAPP9669"></a><a id="CCAPP9670"></a><a id="CCAPP9671"></a><a id="CCAPP9672"></a><a id="CCAPP9673"></a><a id="CCAPP9674"></a><a id="CCAPP9667"></a><div class="props_rev_3"><a id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382" name="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382"></a><h5 id="CCAPP-GUID-19B22A53-0B88-483E-9909-49EC1FAF1382" class="sect5"><span class="enumeration_section">A.2.3.3 loader.dat的</span> HTML文件示例</h5>
                     <div>
                        <p>这里包含了命名并加载到<code class="codeph">loader.dat</code>中的HTML文件，供您参考，如下所示：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADFIGC">Pizza.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIABDAHF">Cantaloupe.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIAFFBAB">Couch.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADDBJJ">Mess.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIAHJBBD">Pet.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADIEFD">Snooze.html</a></p>
                           </li>
                        </ul>
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADFIGC">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-33B5C08D-1D1E-4BD2-9333-7FD27846FCC1">Pizza.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;The Pizza Shredder&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
 
&lt;h2&gt;The Pizza Shredder&lt;/h2&gt;
&lt;h4&gt;Keeping your pizza preferences secure&lt;/h4&gt;
 
So it's the end of a long evening. Beer has been drunk, pizza has been eaten.
&lt;p&gt;
But there's leftover pizza - what are you going to do with it?
 
&lt;p&gt;
You could save it for the morning, or you could feed it to your pet.  But if neither of those appeal (maybe you don't have a pet?) then 
you'll be throwing it in the trash.
 
&lt;p&gt;
But wait a minute - anybody could look through your trash, and figure out what kind of pizza you've been eating! "No big deal," I hear you 
say. But it is! After they've figured out that your favorite pizza is pepperoni, then it's only a short step to figuring out that 
your top-secret online banking password is "pepperoni_pizza."
 
&lt;p&gt;
Get one over the dumpster-divers with our new patent-pending "Mk III Pizza Shredder." Cross-cut blades ensure that your pizza will be rendered 
unreadable, and nobody will be able to identify the original toppings. Also doubles as a lettuce-shredder and may also be used for removing 
unwanted fingertips.
 
&lt;h2&gt;Model Comparison&lt;/h2&gt;
 
&lt;table border="1"&gt;
  &lt;tr&gt;&lt;th&gt;Model&lt;/th&gt;&lt;th&gt;Blades0&lt;/th&gt;&lt;th&gt;Pizza Thickness&lt;/th&gt;&lt;th&gt;Price&lt;/th&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Mk I&lt;/td&gt;&lt;td&gt;Plastic&lt;/td&gt;&lt;td&gt;1/2 inch (Thin Crust)&lt;/td&gt;&lt;td&gt;$69.99&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Mk II&lt;/td&gt;&lt;td&gt;Brass&lt;/td&gt;&lt;td&gt;1 inch (Deep Pan)&lt;/td&gt;&lt;td&gt;$99.99&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Mk III&lt;/td&gt;&lt;td&gt;Carbon Steel&lt;/td&gt;&lt;td&gt;2 inch (Calzoni)&lt;/td&gt;&lt;td&gt;$129.99&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIABDAHF">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-D36AB4E7-152C-4078-8767-C8421B294D2D">Cantaloupe.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;The Fridge with a Cantaloupe Dispenser&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;The Fridge with a Cantaloupe Dispenser&lt;/h2&gt;
&lt;h4&gt;A nice cold melon at the touch of a button&lt;/h4&gt;
 
Does your refrigerator only have a boring water dispenser in the door?
 
&lt;p&gt;
When you're hungry for a cantaloupe, do you have to expend valuable energy opening the fridge door and fishing around amongst the half-used
 packets of pet food?
 
&lt;p&gt;
Do your friends complain that they wish there was an effortless way to get cantaloupes from your fridge? Do you overhear them saying they're 
tired of always having to rummage through your moldy leftovers and seal-a-meals to get to the cold melons?
 
&lt;p&gt;
What you need is the convenience of a built-in cantaloupe dispenser.
 
&lt;p&gt;
Impress your friends. Win praise from your neighbors. Become a legendary host!
 
&lt;p&gt;
&lt;b&gt;Try our new &lt;i&gt;Melonic 2000&lt;/i&gt; model!&lt;/b&gt;
 
&lt;p&gt;
Works with honeydews and small crenshaws too.
 
&lt;p&gt;
Let the &lt;i&gt;Melonic 2000&lt;/i&gt; go to work for you. Order one now at your local store.
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIAFFBAB">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-9C11CD5F-2665-41EB-B3C4-981C16145826">Couch.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;The Self-Tipping Couch&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;The Self-Tipping Couch&lt;/h2&gt;
 
&lt;h4&gt;Sometimes it's hard work to get off the couch&lt;/h4&gt;
 
&lt;p&gt;
Sometimes it's hard work to get your partner, or your pet, off the couch.
 
&lt;p&gt;
The &lt;b&gt;Self-Tipping Couch&lt;/b&gt; solves these problems for you. At the touch of a button it will deposit the contents of the couch onto the
 floor in front of it. 
 
&lt;p&gt;
The &lt;b&gt;Self-Tipping Couch&lt;/b&gt; has been proven to boost communication with stubborn spouses, children, and relatives. 
 
&lt;p&gt;
You will never again need to yell, "Get off the couch!" Simply press a button and all those couch hoggers are gently 
dumped onto your carpet.
 
&lt;p&gt;
Get your own &lt;b&gt;Self-Tipping Couch&lt;/b&gt; TODAY!
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADDBJJ">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-66105F44-D4CD-4B2A-8B8A-3EE6EFEC87C2">Mess.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;Home Air Dirtier&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;Home Air Dirtier&lt;/h2&gt;
&lt;h4&gt;Missing your home in the middle of the city?&lt;/h4&gt;
 
&lt;p&gt;
Like many ex-city-dwellers, you might be finding that the air in the countryside is just too clean.
 
&lt;p&gt;
You can remedy this right now with the &lt;i&gt;UltraAppliance&lt;/i&gt; &lt;b&gt;Home Air Dirtier&lt;/b&gt;. 
 
&lt;p&gt;
Simply insert our patented &lt;i&gt;CityFilth&lt;/i&gt; cartridge, and soon you'll be enjoying the aromas of vehicle fumes and decaying garbage that 
you're used to from home.
 
&lt;p&gt;
&lt;b&gt;Please note:&lt;/b&gt; Decaying garbage smells may confuse your pet. No matter how much he hunts, he will not be able to find the garbage he can 
smell. 
We recommend adding genuine garbage to your environment if this is a concern.
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIAHJBBD">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-641EA50F-16B0-4319-89E7-B2DA86514E99">Pet.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;The Pet Magnet&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;The Pet Magnet&lt;/h2&gt;
 
&lt;h4&gt;Every pet owner loves to let his or her pet run free, but that's not always possible&lt;/h4&gt;
 
&lt;p&gt;
Sometimes local laws require pets to be on leashes. Sometimes a free-roaming pet will ruin a flower bed, leave a "calling card" on the 
sidewalk, or chew through another pet. In the case of extremely smart pets, like chimpanzees or dolphins, the unattended pet may get 
away and run up hundreds of dollars of long-distance charges on your phone.
 
&lt;p&gt;
But leashes aren't always a practical answer. They can be too confining, or too big, or can tug uncomfortably at the pet's neck. They 
may get tangled, or wrapped around poles or passersby. Pets may chew through the leash, or, again, in the case of extremely smart pets, 
burn through it with an acetylene torch. In the case of cats, leashes simply look ridiculous, as though the pet owner really wanted to 
own a dog but got confused at the pet store.
 
&lt;p&gt; 
The &lt;b&gt;Hold 'Em 2000 Pet Magnet&lt;/b&gt; from &lt;i&gt;UltraAppliance&lt;/i&gt; is the answer. Instead of old-fashioned leashes, the 
&lt;b&gt;Hold 'Em 2000 Pet Magnet&lt;/b&gt; keeps your pet under control in a humane and simple way.
 
&lt;p&gt;
Here's how it works. Dozens of small magnets are placed underneath the coat of your pet, where they remain painlessly invisible. Any time 
you need to recall your animal, you merely activate the handy, massive Hold 'Em 2000 Pet Magnet electromagnet (fits inside any extremely 
oversized purse) and your pet is gently and painlessly dragged to you from up to 100 yards. It's a must-have for any pet owner!
 
&lt;p&gt;
 
&lt;blockquote&gt;
&lt;i&gt;
"The &lt;b&gt;Hold 'Em 2000 Pet Magnet&lt;/b&gt; not only keeps my dog from running away, but the electromagnet also comes in very handy if I need to 
find a needle in a haystack"&lt;/i&gt;
-- Anonymous Celebrity
&lt;/blockquote&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADIEFD">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-E18900F8-5F54-4D95-8762-10FFD019F719">Snooze.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;Esteem-building Talking Pillow&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;Esteem-building Talking Pillow&lt;/h2&gt;
&lt;h4&gt;Do you feel less than your true potential when you wake up in the morning?&lt;/h4&gt;
 
&lt;p&gt;
We searched for a way to capture the wasted time spent sleeping and to use this precious time to build motivation, character, and self-esteem.
 
&lt;p&gt;
We are proud to announce the &lt;b&gt;Esteem-building Talking Pillow&lt;/b&gt;. Our pride in this wonderful invention glows even more because: 
&lt;i&gt;We use our own invention every night!&lt;/i&gt;
 
&lt;p&gt;
Only you will know that you are sleeping with the &lt;b&gt;Esteem-building Talking Pillow&lt;/b&gt; because only you can hear the soothing 
affirmations that gently enter your brain through the discreet speaker.
 
&lt;p&gt;
You will wake up refreshed and raring to go with a new sense of pride and enthusiasm for any task the day may bring. 
 
&lt;p&gt;
Be the first to own the &lt;b&gt;Esteem-building Talking Pillow&lt;/b&gt;! Your friends and fellow workers will be amazed when you no longer 
cower in the corner. Now you will join in every conversation.
 
&lt;p&gt;
&lt;b&gt;Disclaimer:&lt;/b&gt; Not responsible for narcissism and hyberbolic statements. May cause extreme behavior with overuse.
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9378"></a><div class="props_rev_3"><a id="GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092" name="GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092"></a><h5 id="CCAPP-GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092" class="sect5"><span class="enumeration_section">A.2.3.4</span> search_htmlservices.sql</h5>
                     <div>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">set define off
 
create or replace package search_htmlServices as
  procedure showHTMLDoc (p_id in numeric);
  procedure showDoc  (p_id in varchar2, p_query in varchar2);
end search_htmlServices;
/
show errors;
 
create or replace package body search_htmlServices as
 
  procedure showHTMLDoc (p_id in numeric) is
    v_clob_selected   CLOB;
    v_read_amount     integer;
    v_read_offset     integer;
    v_buffer          varchar2(32767);
   begin
 
     select text into v_clob_selected from search_table where tk = p_id;
     v_read_amount := 32767;
     v_read_offset := 1;
   begin
    loop
      dbms_lob.read(v_clob_selected,v_read_amount,v_read_offset,v_buffer);
      htp.print(v_buffer);
      v_read_offset := v_read_offset + v_read_amount;
      v_read_amount := 32767;
    end loop;
   exception
   when no_data_found then
     null;
   end;
 end showHTMLDoc;
 
procedure showDoc (p_id in varchar2, p_query in varchar2) is
 
 v_clob_selected   CLOB;
 v_read_amount     integer;
 v_read_offset     integer;
 v_buffer          varchar2(32767);
 v_query           varchar(2000);
 v_cursor          integer;
 
 begin
   htp.p('&lt;html&gt;&lt;title&gt;HTML version with highlighted terms&lt;/title&gt;');
   htp.p('&lt;body bgcolor="#ffffff"&gt;');
   htp.p('&lt;b&gt;HTML version with highlighted terms&lt;/b&gt;');
 
   begin
     ctx_doc.markup (index_name =&gt; 'idx_search_table',
                     textkey    =&gt; p_id,
                     text_query =&gt; p_query,
                     restab     =&gt; v_clob_selected,
                     starttag   =&gt; '&lt;i&gt;&lt;font color=red&gt;',
                     endtag     =&gt; '&lt;/font&gt;&lt;/i&gt;');
 
     v_read_amount := 32767;
     v_read_offset := 1;
     begin
      loop
        dbms_lob.read(v_clob_selected,v_read_amount,v_read_offset,v_buffer);
        htp.print(v_buffer);
        v_read_offset := v_read_offset + v_read_amount;
        v_read_amount := 32767;
      end loop;
     exception
      when no_data_found then
         null;
     end;
 
     exception
      when others then
        null; --showHTMLdoc(p_id);
   end;
end showDoc;
end search_htmlServices; 
/
show errors
 
set define on</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9379"></a><div class="props_rev_3"><a id="GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80" name="GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80"></a><h5 id="CCAPP-GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80" class="sect5"><span class="enumeration_section">A.2.3.5</span> search_html.psp</h5>
                     <div>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;%@ plsql procedure="search_html" %&gt;
&lt;%@ plsql parameter="query" default="null" %&gt;
&lt;%! v_results number := 0; %&gt;
 
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;search_html Search &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
 
&lt;%
 
IF query IS NULL THEN
%&gt;
 
  &lt;center&gt;
    &lt;form method="post" action="search_html"&gt;
     &lt;b&gt;Search for: &lt;/b&gt;
     &lt;input type="text" name="query" size="30"&gt;&amp;nbsp;
     &lt;input type="submit" value="Search"&gt;
  &lt;/center&gt;
&lt;hr&gt;
 
&lt;% 
  ELSE
%&gt;
 
   &lt;p&gt;
   &lt;%!
      color varchar2(6) := 'ffffff';
   %&gt;
 
   &lt;center&gt;
     &lt;form method="post" action="search_html"&gt;
      &lt;b&gt;Search for:&lt;/b&gt;
      &lt;input type="text" name="query" size="30" value="&lt;%= query %&gt;"&gt;
      &lt;input type="submit" value="Search"&gt;
     &lt;/form&gt;
   &lt;/center&gt;
   &lt;hr&gt;
   &lt;p&gt;
 
   &lt;%
     -- select statement 
    FOR DOC IN (
                SELECT /*+ DOMAIN_INDEX_SORT */ rowid, tk, title, score(1) scr
                FROM search_table
                WHERE CONTAINS(text, query,1) &gt;0
                ORDER BY score(1) DESC
               ) 
         LOOP
           v_results := v_results + 1;
           IF v_results = 1 THEN
 
   %&gt;
 
             &lt;center&gt;
              &lt;table border="0"&gt;
                &lt;tr bgcolor="#6699CC"&gt;
                  &lt;th&gt;Score&lt;/th&gt;
                  &lt;th&gt;Title&lt;/th&gt;
                &lt;/tr&gt;
 
  &lt;%      END IF; %&gt;
          &lt;tr bgcolor="#&lt;%= color %&gt;"&gt;
           &lt;td&gt; &lt;%= doc.scr %&gt;% &lt;/td&gt;
           &lt;td&gt; &lt;%= doc.title %&gt;
           [&lt;a href="search_htmlServices.showHTMLDoc?p_id=
                  &lt;%= doc.tk %&gt;"&gt;HTML&lt;/a&gt;]
           [&lt;a href="search_htmlServices.showDoc?p_id=
                  &lt;%= doc.tk %&gt;&amp;p_query=&lt;%= query %&gt;"&gt;Highlight&lt;/a&gt;]
           &lt;/td&gt;
         &lt;/tr&gt;
 
   &lt;%
          IF (color = 'ffffff') THEN
               color := 'eeeeee';
             ELSE
               color := 'ffffff';
          END IF;
 
     END LOOP; 
   %&gt;
 
    &lt;/table&gt;
   &lt;/center&gt;
 
&lt;% 
  END IF;
%&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="CCAPP9380"></a><div class="props_rev_3"><a id="GUID-DEABF1DC-7C2E-436D-A83F-D036260B0B32" name="GUID-DEABF1DC-7C2E-436D-A83F-D036260B0B32"></a><h3 id="CCAPP-GUID-DEABF1DC-7C2E-436D-A83F-D036260B0B32" class="sect3"><span class="enumeration_section">A.3</span> Java Server Pages（JSP）Web应用程序</h3>
               <div>
                  <p>创建基于JSP的Web应用程序涉及与构建基于PSP的应用程序中使用的大多数步骤相同的步骤。有关更多信息，请参阅<span class="q">“ <a href="CONTEXT-query-application.html#GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B">构建PSP Web应用程序</a> ”</span> 。您可以使用相同的<code class="codeph">loader.dat</code>和<code class="codeph">loader.ctl</code>文件。但是，使用基于JSP的应用程序，您不需要执行以下操作：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>编译<code class="codeph">search_htmlservices</code>包</p>
                     </li>
                     <li>
                        <p>编译<code class="codeph">search_html</code>与PSP页<code class="codeph">loadpsp</code></p>
                     </li>
                  </ul>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01">JSP Web应用程序先决条件</a></p>
                     </li>
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-CC35F085-B0A1-450D-B5C5-1E16C747AF0A">JSP Web应用程序示例代码</a></p>
                     </li>
                  </ul>
               </div><a id="CCAPP9381"></a><div class="props_rev_3"><a id="GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01" name="GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01"></a><h4 id="CCAPP-GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01" class="sect4"><span class="enumeration_section">A.3.1</span> JSP Web应用程序先决条件</h4>
                  <div>
                     <p>JSP Web应用程序具有以下要求：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您的Oracle数据库必须已启动并正在运行。</p>
                        </li>
                        <li>
                           <p>您有一个Web服务器，例如Apache Tomcat，它可以运行使用Java数据库连接（JDBC）连接到Oracle数据库的JavaServer Pages（JSP）脚本。</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01__GUID-0BB76621-754C-47F3-B3BD-A0AE6787D5CC">
                        <p class="notep1">也可以看看：</p>
                        <p>有关安装Apache HTTP Server的信息，请参阅<span class="italic">Oracle Database 2 Day + PHP Developer's Guide</span></p>
                     </div>
                  </div>
               </div><a id="CCAPP9382"></a><div class="props_rev_3"><a id="GUID-CC35F085-B0A1-450D-B5C5-1E16C747AF0A" name="GUID-CC35F085-B0A1-450D-B5C5-1E16C747AF0A"></a><h4 id="CCAPP-GUID-CC35F085-B0A1-450D-B5C5-1E16C747AF0A" class="sect4"><span class="enumeration_section">A.3.2</span> JSP Web应用程序示例代码</h4>
                  <div>
                     <p>本节列出了用于构建示例Web应用程序的Java代码，如<code class="codeph">TextSearchApp.jsp</code>文件中所示。
                     </p><pre class="oac_no_warn" dir="ltr">&lt;%@page language="java" pageEncoding="utf-8" contentType="text/html; charset=utf-8" %&gt;
&lt;%@ page import="java.sql.*, java.util.*, java.net.*, 
   oracle.jdbc.*, oracle.sql.*, oracle.jsp.dbutil.*" %&gt;
 
&lt;%
// Change these details to suit your database and user details
 
String connStr = "jdbc:oracle:thin:@//servername:1521/pdb1";
String dbUser  = "scott";
String dbPass  = "tiger";
 
// The table we're running queries against is called SEARCH_TABLE.
// It must have columns:
//  tk     number  primary key,     (primary key is important for document services)
//  title  varchar2(2000),
//  text   clob
// There must be a CONTEXT index called IDX_SEARCH_TABLE on the text column
 
request.setCharacterEncoding("UTF-8");
 
java.util.Properties info=new java.util.Properties();
Connection conn  = null;
ResultSet rset   = null;
OracleCallableStatement callStmt = null;
Statement stmt   = null;
String userQuery = null;
String myQuery   = null;
String action    = null;
String theTk     = null;
URLEncoder myEncoder;
int count=0;
int loopNum=0;
int startNum=0;
 
userQuery     =   request.getParameter("query");
action        =   request.getParameter("action");
theTk         =   request.getParameter("tk");
 
if (action == null)  action = "";
 
// Connect to database
 
try {
  DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver() );
  info.put ("user",     dbUser);
  info.put ("password", dbPass);
  conn      = DriverManager.getConnection(connStr,info);
}
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt;  &lt;%
  } 
 
if ( action.equals("doHTML") ) {
  // Directly display the text of the document
  try {
 
    // not attempting to share the output table for this example, we'll truncate it each time
    conn.createStatement().execute("truncate table OUTPUT_TABLE");
 
    String sql = "{ call ctx_doc.filter( index_name=&gt;'IDX_SEARCH_TABLE', textkey=&gt; '" + theTk + "', restab=&gt;'OUTPUT_TABLE', 
                  plaintext=&gt;false ) }";
    PreparedStatement s = conn.prepareCall( sql );
    s.execute();
 
    sql = "select document from output_table where rownum = 1";
    stmt = conn.createStatement();
    rset = stmt.executeQuery(sql);
 
    rset.next();
    oracle.sql.CLOB res = (oracle.sql.CLOB) rset.getClob(1);
    // should fetch from clob piecewise, but to keep it simple we'll just fetch 32K to a string
    String txt = res.getSubString(1, 32767);
    out.println(txt);
  }
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt; &lt;%
  }
}
else if ( action.equals("doHighlight") ) {
  // Display the text of the document with highlighting from the "markup" function
  try {
 
    // not attempting to share the output table for this example, we'll truncate it each time
    conn.createStatement().execute("truncate table OUTPUT_TABLE");
 
    String sql = "{ call ctx_doc.markup( index_name=&gt;'IDX_SEARCH_TABLE', textkey=&gt; '" + theTk + "', text_query =&gt; '" + userQuery + "', 
                  restab=&gt;'OUTPUT_TABLE', plaintext=&gt;false, starttag =&gt; '&lt;i&gt;&lt;font color=\"red\"&gt;', endtag =&gt; '&lt;/font&gt;&lt;/i&gt;' ) }";
    PreparedStatement s = conn.prepareCall( sql );
    s.execute();
 
    sql = "select document from output_table where rownum = 1";
    stmt = conn.createStatement();
    rset = stmt.executeQuery(sql);
 
    rset.next();
    oracle.sql.CLOB res = (oracle.sql.CLOB) rset.getClob(1);
    // should fetch from clob piecewise, but to keep it simple we'll just fetch 32K to a string
    String txt = res.getSubString(1, 32767);
    out.println(txt);
  }
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt; &lt;%
  }
}
 
else if ( action.equals("doThemes") ) {
  // Display the text of the document with highlighting from the "markup" function
  try {
 
    // not attempting to share the output table for this example, we'll truncate it each time
    conn.createStatement().execute("truncate table THEME_TABLE");
 
    String sql = "{ call ctx_doc.themes( index_name=&gt;'IDX_SEARCH_TABLE', textkey=&gt; '" + theTk + "', restab=&gt;'THEME_TABLE') }";
    PreparedStatement s = conn.prepareCall( sql );
    s.execute();
 
    sql = "select * from ( select theme, weight from theme_table order by weight desc ) where rownum &lt;= 20";
    stmt = conn.createStatement();
    rset = stmt.executeQuery(sql);
    int    weight = 0;
    String theme  = "";
%&gt;
    &lt;h2&gt;The top 20 themes of the document&lt;/h2&gt;
    &lt;table BORDER=1 CELLSPACING=0 CELLPADDING=0"
       &lt;tr bgcolor="#CCCC99"&gt;
       &lt;th&gt;&lt;font face="arial" color="#336699"&gt;Theme&lt;/th&gt;
       &lt;th&gt;&lt;font face="arial" color="#336699"&gt;Weight&lt;/th&gt;
       &lt;/tr&gt;
&lt;%
    while ( rset.next() ) {
 
      theme  = rset.getString(1); 
      weight = (int)rset.getInt(2);
%&gt;
       &lt;tr bgcolor="ffffe0"&gt;
         &lt;td align="center"&gt;&lt;font face="arial"&gt;&lt;b&gt; &lt;%= theme  %&gt; &lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
         &lt;td align="center"&gt;&lt;font face="arial"&gt; &lt;%= weight %&gt;&lt;/font&gt;&lt;/td&gt;
       &lt;/tr&gt;
&lt;%
    }
 
%&gt;
&lt;/table&gt;
&lt;%
  }
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt; &lt;%
  }
}
else if ( action.equals("doGists") ) {
  // Display the text of the document with highlighting from the "markup" function
  try {
 
    // not attempting to share the output table for this example, we'll truncate it each time
    conn.createStatement().execute("truncate table GIST_TABLE");
 
    String sql = "{ call ctx_doc.gist( index_name=&gt;'IDX_SEARCH_TABLE', textkey=&gt; '" + theTk + "', restab=&gt;'GIST_TABLE', query_id=&gt;1) }";
    PreparedStatement s = conn.prepareCall( sql );
    s.execute();
 
    sql = "select pov, gist from gist_table where pov = 'GENERIC' and query_id = 1";
    stmt = conn.createStatement();
    rset = stmt.executeQuery(sql);
    String pov   = "";
    String gist  = "";
 
    while ( rset.next() ) {
 
      pov   = rset.getString(1); 
      oracle.sql.CLOB gistClob = (oracle.sql.CLOB) rset.getClob(2);
 
      out.println("&lt;h3&gt;Document Gist for Point of View: " + pov + "&lt;/h3&gt;");
      gist = gistClob.getSubString(1, 32767);
      out.println(gist);
 
    }
 
%&gt;
&lt;/table&gt;
&lt;%
  }
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt; &lt;%
  }
}
 
if ( (action.equals("")) &amp;&amp; ( (userQuery == null) || (userQuery.length() == 0) ) ) {
%&gt;
  &lt;html&gt;
    &lt;title&gt;Text Search&lt;/title&gt;
    &lt;body&gt;
      &lt;table width="100%"&gt;
        &lt;tr bgcolor="#336699"&gt;
          &lt;td&gt;&lt;font face="arial" align="left" 
          color="#CCCC99" size="+2"&gt;Text Search&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
    &lt;center&gt;
      &lt;form method = post&gt;
      Search for:
      &lt;input type="text" name="query" size = "30"&gt;
      &lt;input type="submit" value="Search"&gt;
      &lt;/form&gt;
    &lt;/center&gt;
    &lt;/body&gt;
  &lt;/html&gt;
&lt;%
}
else if (action.equals("") ) {
%&gt;
  &lt;html&gt;
    &lt;title&gt;Text Search Result Page&lt;/title&gt;
    &lt;body text="#000000" bgcolor="#FFFFFF" link="#663300" 
          vlink="#996633" alink="#ff6600"&gt;
      &lt;table width="100%"&gt;
        &lt;tr bgcolor="#336699"&gt;
          &lt;td&gt;&lt;font face="arial" align="left" 
                 color="#CCCC99" size=+2&gt;Text Search&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
    &lt;center&gt;
      &lt;form method = post action="TextSearchApp.jsp"&gt;
      Search for:
      &lt;input type=text name="query" value="&lt;%= userQuery %&gt;" size = 30&gt;
      &lt;input type=submit value="Search"&gt;
      &lt;/form&gt;
    &lt;/center&gt;
&lt;%
  myQuery   =   URLEncoder.encode(userQuery);
  try {
 
    stmt      = conn.createStatement();
 
    String numStr =   request.getParameter("sn");
    if(numStr!=null)
      startNum=Integer.parseInt(numStr);
    String theQuery =   translate(userQuery);
 
    callStmt =(OracleCallableStatement)conn.prepareCall("begin "+
         "?:=ctx_query.count_hits(index_name=&gt;'IDX_SEARCH_TABLE', "+
         "text_query=&gt;?"+
         "); " +
         "end; ");
    callStmt.setString(2,theQuery);
    callStmt.registerOutParameter(1, OracleTypes.NUMBER);
    callStmt.execute();
    count=((OracleCallableStatement)callStmt).getNUMBER(1).intValue();
    if(count&gt;=(startNum+20)){
%&gt;
    &lt;font color="#336699" FACE="Arial" SIZE=+1&gt;Results
           &lt;%=startNum+1%&gt; - &lt;%=startNum+20%&gt; of &lt;%=count%&gt; matches
&lt;%
    }
    else if(count&gt;0){
%&gt;
    &lt;font color="#336699" FACE="Arial" SIZE=+1&gt;Results
           &lt;%=startNum+1%&gt; - &lt;%=count%&gt; of &lt;%=count%&gt; matches
&lt;%
    }
    else {
%&gt;
    &lt;font color="#336699" FACE="Arial" SIZE=+1&gt;No match found
&lt;%
    }
%&gt;
  &lt;table width="100%"&gt;
  &lt;TR ALIGN="RIGHT"&gt;
&lt;%
  if((startNum&gt;0)&amp;(count&lt;=startNum+20))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum-20 %&gt;&amp;query=
            &lt;%=myQuery %&gt;"&gt;previous20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
  else if((count&gt;startNum+20)&amp;(startNum==0))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum+20 
          %&gt;&amp;query=&lt;%=myQuery %&gt;"&gt;next20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
  else if((count&gt;startNum+20)&amp;(startNum&gt;0))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum-20 %&gt;&amp;query=
              &lt;%=myQuery %&gt;"&gt;previous20&lt;/a&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum+20 %&gt;&amp;query=
              &lt;%=myQuery %&gt;"&gt;next20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
%&gt;
  &lt;/TR&gt;
  &lt;/table&gt;
&lt;%
    String ctxQuery = 
        " select /*+ FIRST_ROWS */ " + 
        "   tk, TITLE, score(1) scr, " +
        "   ctx_doc.snippet ('IDX_SEARCH_TABLE', tk, '" + theQuery + "') " + 
        " from search_table " + 
        " where contains(TEXT, '"+theQuery+"',1 ) &gt; 0 " +
        " order by score(1) desc"; 
    rset = stmt.executeQuery(ctxQuery);
    String   tk           = null;
    String[] colToDisplay = new String[1];
    int      myScore      = 0;
    String   snippet      = "";
    int      items        = 0;
    while (rset.next()&amp;&amp;items&lt; 20) {
      if(loopNum&gt;=startNum)
      {
        tk = rset.getString(1);
        colToDisplay[0] = rset.getString(2);
        myScore         = (int)rset.getInt(3);
        snippet         = rset.getString(4);
        items++;
        if (items == 1) {
%&gt;
        &lt;center&gt;
          &lt;table BORDER=1 CELLSPACING=0 CELLPADDING=0 width="100%"
            &lt;tr bgcolor="#CCCC99"&gt;
              &lt;th&gt;&lt;font face="arial" color="#336699"&gt;Score&lt;/th&gt;
              &lt;th&gt;&lt;font face="arial" color="#336699"&gt;TITLE&lt;/th&gt;
              &lt;th&gt;&lt;font face="arial" color="#336699"&gt;Snippet&lt;/th&gt;
              &lt;th&gt; &lt;font face="arial" 
                       color="#336699"&gt;Document Services&lt;/th&gt;
            &lt;/tr&gt;
&lt;%   } %&gt;
      &lt;tr bgcolor="#FFFFE0"&gt;
        &lt;td ALIGN="CENTER"&gt; &lt;%= myScore %&gt;%&lt;/td&gt;
        &lt;td&gt; &lt;%= colToDisplay[0] %&gt; &lt;/td&gt;
        &lt;td&gt; &lt;%= snippet %&gt; &lt;/td&gt;
        &lt;td&gt;
          &lt;a href="TextSearchApp.jsp?action=doHTML&amp;tk=&lt;%= tk %&gt;"&gt;HTML&lt;/a&gt; &amp;nbsp;
          &lt;a href="TextSearchApp.jsp?action=doHighlight&amp;tk=&lt;%= tk %&gt;&amp;query=&lt;%= theQuery %&gt;"&gt;Highlight&lt;/a&gt; &amp;nbsp;
          &lt;a href="TextSearchApp.jsp?action=doThemes&amp;tk=&lt;%= tk %&gt;&amp;query=&lt;%= theQuery %&gt;"&gt;Themes&lt;/a&gt; &amp;nbsp;
          &lt;a href="TextSearchApp.jsp?action=doGists&amp;tk=&lt;%= tk %&gt;"&gt;Gist&lt;/a&gt; &amp;nbsp;
        &lt;/td&gt;
      &lt;/tr&gt;
&lt;%
      }
      loopNum++;
    }
} catch (SQLException e) {
%&gt;
    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt;
&lt;%
} finally {
  if (conn != null) conn.close();
  if (stmt != null) stmt.close();
  if (rset != null) rset.close();
  }
%&gt;
  &lt;/table&gt;
  &lt;/center&gt;
  &lt;table width="100%"&gt;
  &lt;TR ALIGN="RIGHT"&gt;
&lt;%
  if((startNum&gt;0)&amp;(count&lt;=startNum+20))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum-20 %&gt;&amp;query=
               &lt;%=myQuery %&gt;"&gt;previous20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
  else if((count&gt;startNum+20)&amp;(startNum==0))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum+20 %&gt;&amp;query=
          &lt;%=myQuery %&gt;"&gt;next20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
  else if((count&gt;startNum+20)&amp;(startNum&gt;0))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum-20 %&gt;&amp;query=
          &lt;%=myQuery %&gt;"&gt;previous20&lt;/a&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum+20 %&gt;&amp;query=
          &lt;%=myQuery %&gt;"&gt;next20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
%&gt;
  &lt;/TR&gt;
  &lt;/table&gt;
  &lt;/body&gt;&lt;/html&gt;
&lt;%}
 
%&gt;
&lt;%!
   public String translate (String input)
   {
      Vector reqWords = new Vector();
      StringTokenizer st = new StringTokenizer(input, " '", true);
      while (st.hasMoreTokens())
      {
        String token = st.nextToken();
        if (token.equals("'"))
        {
           String phrase = getQuotedPhrase(st);
           if (phrase != null)
           {
              reqWords.addElement(phrase);
           }
        }
        else if (!token.equals(" "))
        {
           reqWords.addElement(token);
        }
      }
      return getQueryString(reqWords);
   }
 
   private String getQuotedPhrase(StringTokenizer st)
   {
      StringBuffer phrase = new StringBuffer();
      String token = null;
      while (st.hasMoreTokens() &amp;&amp; (!(token = st.nextToken()).equals("'")))
      {
        phrase.append(token);
      }
      return phrase.toString();
   }
  
   private String getQueryString(Vector reqWords)
   {
      StringBuffer query = new StringBuffer("");
      int length = (reqWords == null) ? 0 : reqWords.size();
      for (int ii=0; ii &lt; length; ii++)
      {
         if (ii != 0)
         {
           query.append(" &amp; ");
         }
         query.append("{");
         query.append(reqWords.elementAt(ii));
         query.append("}");
      }
      return query.toString();
   }
%&gt;</pre></div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>