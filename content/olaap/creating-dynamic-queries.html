<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>创建动态查询</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java API Developer&#39;s Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java API Developer&#39;s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="olap-java-api-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-10T13:53:39-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2000, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96402-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="retrieving-query-results.html" title="Previous" type="text/html">
      <link rel="next" href="setting-up-development-environment.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OLAP Java API Developer&#39;s Guide">
    <meta name="dcterms.isVersionOf" content="OLAAP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="retrieving-query-results.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="setting-up-development-environment.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java API开发人员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">创建动态查询</li>
            </ol>
            <a id="GUID-16DC09F2-FA92-4987-A125-2EE813B7413E" name="GUID-16DC09F2-FA92-4987-A125-2EE813B7413E"></a><a id="OLAAP382"></a>
            
            <h2 id="OLAAP-GUID-16DC09F2-FA92-4987-A125-2EE813B7413E" class="sect2"><span class="enumeration_chapter">10</span>创建动态查询</h2>
         </header>
         <div class="ind">
            <div>
               <p>要创建动态查询，请使用Oracle OLAP Java API <code class="codeph">Template</code>类和其他相关类。以下主题描述了这些类，并提供了它们的实现示例。
               </p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="creating-dynamic-queries.html#GUID-1E84C8D1-E38F-4C46-AD72-D6F01FEB504D">关于模板对象</a></p>
                  </li>
                  <li>
                     <p><a href="creating-dynamic-queries.html#GUID-7446C31F-22A8-4476-9C70-574047267AB3">模板和相关类概述</a></p>
                  </li>
                  <li>
                     <p><a href="creating-dynamic-queries.html#GUID-BC9CA1ED-CA43-42C3-BB63-D70DF3F4CB43">设计和实现模板</a></p>
                  </li>
               </ul>
            </div><a id="OLAAP383"></a><div class="props_rev_3"><a id="GUID-1E84C8D1-E38F-4C46-AD72-D6F01FEB504D" name="GUID-1E84C8D1-E38F-4C46-AD72-D6F01FEB504D"></a><h3 id="OLAAP-GUID-1E84C8D1-E38F-4C46-AD72-D6F01FEB504D" class="sect3"><span class="enumeration_section">10.1</span>关于模板对象</h3>
               <div>
                  <p><a id="d28686e88" class="indexterm-anchor"></a><a id="d28686e92" class="indexterm-anchor"></a><a id="d28686e94" class="indexterm-anchor"></a><a id="d28686e98" class="indexterm-anchor"></a> <code class="codeph">Template</code>类是Oracle OLAP Java API非常强大功能的基础。您使用<code class="codeph">Template</code>对象来创建可修改的<code class="codeph">Source</code>对象。使用这些<code class="codeph">Source</code>对象，您可以创建可以响应最终用户选择而更改的动态查询。<code class="codeph">Template</code>对象还为您提供了一种将用户界面元素转换为OLAP Java API操作和对象的便捷方式。
                  </p>
                  <p>有关用于更改动态<code class="codeph">Source</code>的<code class="codeph">Transaction</code>对象以及保存或放弃这些更改的信息，请参阅<a href="using-transaction-provider.html#GUID-E290E8B5-CC10-4BDF-91B1-7189BE7F12B9">使用TransactionProvider</a> 。
                  </p>
               </div><a id="OLAAP384"></a><div class="props_rev_3"><a id="GUID-4E2695FD-52C1-4610-9B3A-3968C725821F" name="GUID-4E2695FD-52C1-4610-9B3A-3968C725821F"></a><h4 id="OLAAP-GUID-4E2695FD-52C1-4610-9B3A-3968C725821F" class="sect4"><span class="enumeration_section">10.1.1</span>关于创建动态源</h4>
                  <div>
                     <p><a id="d28686e166" class="indexterm-anchor"></a> <code class="codeph">Template</code>的主要特征是能够生成动态<code class="codeph">Source</code> 。该功能基于<code class="codeph">Template</code>使用的两个其他对象： <code class="codeph">DynamicDefinition</code>和<code class="codeph">MetadataState</code>类的实例。
                     </p>
                     <p><a id="d28686e187" class="indexterm-anchor"></a>创建<code class="codeph">Source</code> ，Oracle OLAP会自动将<code class="codeph">SourceDefinition</code>与其关联。<code class="codeph">SourceDefinition</code>包含有关<code class="codeph">Source</code>信息。一旦创建， <code class="codeph">Source</code>和相关的<code class="codeph">SourceDefinition</code>地关联起来。<code class="codeph">SourceDefinition</code>的<code class="codeph">getSource</code>方法返回与之关联的<code class="codeph">Source</code> 。
                     </p>
                     <p><a id="d28686e219" class="indexterm-anchor"></a> <code class="codeph">DynamicDefinition</code>是<code class="codeph">SourceDefinition</code>的子类。甲<code class="codeph">Template</code>创建<code class="codeph">DynamicDefinition</code> ，其充当代理<code class="codeph">SourceDefinition</code>所述的<code class="codeph">Source</code>通过所产生的<code class="codeph">Template</code> 。这意味着， <code class="codeph">DynamicDefinition</code>的<code class="codeph">getSource</code>方法不是始终获得相同的不可变关联的<code class="codeph">Source</code> ，而是获取<code class="codeph">Template</code>当前生成的任何<code class="codeph">Source</code> 。即使它获得的<code class="codeph">Source</code>不同， <code class="codeph">DynamicDefinition</code>的实例也不会更改。
                     </p>
                     <p><code class="codeph">Template</code>生成的<code class="codeph">Source</code>可以更改，因为<code class="codeph">Template</code>用于创建<code class="codeph">Source</code>的值（包括其他<code class="codeph">Source</code>对象）可以更改。<code class="codeph">Template</code>将这些值存储在<code class="codeph">MetadataState</code> 。<code class="codeph">Template</code>提供了获取<code class="codeph">MetadataState</code>的当前状态，获取或设置值以及设置状态的方法。您可以使用这些方法更改<code class="codeph">MetadataState</code>存储的数据值。
                     </p>
                     <p>您使用<code class="codeph">DynamicDefinition</code>来获取<code class="codeph">Template</code>生成的<code class="codeph">Source</code> 。如果您的应用程序更改了<code class="codeph">Template</code>用于创建<code class="codeph">Source</code>的值的状态，例如，为了响应最终用户选择，则应用程序使用相同的<code class="codeph">DynamicDefinition</code>再次获取<code class="codeph">Source</code> ，即使新<code class="codeph">Source</code>定义了结果设置与上一个<code class="codeph">Source</code>不同。
                     </p>
                     <p><code class="codeph">Template</code>生成的<code class="codeph">Source</code>可以是一系列创建其他<code class="codeph">Source</code>对象的<code class="codeph">Source</code>操作的结果，例如一系列选择，排序，计算和连接。您将这些操作的代码放在<code class="codeph">Template</code>的<code class="codeph">SourceGenerator</code>的<code class="codeph">generateSource</code>方法中。该方法返回<code class="codeph">Template</code>生成的<code class="codeph">Source</code> 。操作使用存储在<code class="codeph">MetadataState</code>中的<code class="codeph">MetadataState</code> 。
                     </p>
                     <p>您可能构建一个极其复杂的查询，该查询涉及由许多不同的<code class="codeph">Template</code>对象生成的动态<code class="codeph">Source</code>对象的交互。查询构建的最终结果是定义整个复杂查询的<code class="codeph">Source</code> 。如果更改用于创建最终<code class="codeph">Source</code>的任何一个<code class="codeph">Template</code>对象的状态，则最终<code class="codeph">Source</code>表示的结果集与前一个<code class="codeph">Source</code>的结果集不同。因此，您可以修改最终查询，而无需重现定义查询所涉及的所有操作。
                     </p>
                  </div>
               </div><a id="OLAAP385"></a><div class="props_rev_3"><a id="GUID-74B1C85F-4056-4068-9B94-A0B46812454B" name="GUID-74B1C85F-4056-4068-9B94-A0B46812454B"></a><h4 id="OLAAP-GUID-74B1C85F-4056-4068-9B94-A0B46812454B" class="sect4"><span class="enumeration_section">10.1.2</span>关于将用户界面元素转换为OLAP Java API对象</h4>
                  <div>
                     <p>您设计<code class="codeph">Template</code>对象以表示应用程序的用户界面的元素。您的<code class="codeph">Template</code>对象将最终用户所做的选择转换为生成<code class="codeph">Source</code> OLAP Java API查询构建操作。然后创建一个<code class="codeph">Cursor</code> ，从Oracle OLAP获取<code class="codeph">Source</code>定义的结果集。您从<code class="codeph">Cursor</code>获取值并将其显示给最终用户。当最终用户更改选择时，您可以更改<code class="codeph">Template</code>的状态。然后，您将获得<code class="codeph">Template</code>生成的<code class="codeph">Source</code> ，创建一个新的<code class="codeph">Cursor</code> ，获取新值并显示它们。
                     </p>
                  </div>
               </div>
            </div><a id="OLAAP386"></a><div class="props_rev_3"><a id="GUID-7446C31F-22A8-4476-9C70-574047267AB3" name="GUID-7446C31F-22A8-4476-9C70-574047267AB3"></a><h3 id="OLAAP-GUID-7446C31F-22A8-4476-9C70-574047267AB3" class="sect3"><span class="enumeration_section">10.2</span>模板和相关类概述</h3>
               <div>
                  <p><a id="d28686e489" class="indexterm-anchor"></a>在OLAP Java API中，几个类一起工作以生成动态<code class="codeph">Source</code> 。在设计<code class="codeph">Template</code> ，您必须实现或扩展以下内容：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">Template</code>抽象类</p>
                     </li>
                     <li>
                        <p><code class="codeph">MetadataState</code>接口</p>
                     </li>
                     <li>
                        <p><code class="codeph">SourceGenerator</code>接口</p>
                     </li>
                  </ul>
                  <p>这三个类的实例以及<code class="codeph">DataProvider</code>和<code class="codeph">DynamicDefinition</code>类的实例一起工作以生成<code class="codeph">Template</code>定义的<code class="codeph">Source</code> 。
                  </p>
               </div><a id="OLAAP387"></a><div class="props_rev_3"><a id="GUID-AC10A8D7-425F-4D6E-9337-FC90A4B0616A" name="GUID-AC10A8D7-425F-4D6E-9337-FC90A4B0616A"></a><h4 id="OLAAP-GUID-AC10A8D7-425F-4D6E-9337-FC90A4B0616A" class="sect4"><span class="enumeration_section">10.2.1</span>生成动态源的类之间的关系是什么？
                  </h4>
                  <div>
                     <p><a id="d28686e568" class="indexterm-anchor"></a>生成动态<code class="codeph">Source</code>的类一起工作如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">Template</code>具有创建<code class="codeph">DynamicDefinition</code>并获取和设置<code class="codeph">MetadataState</code>的当前状态的方法。<code class="codeph">Template</code>抽象类的扩展添加了获取和设置<code class="codeph">MetadataState</code>上字段值的方法。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">MetadataState</code>实现具有用于存储用于生成<code class="codeph">Template</code> <code class="codeph">Source</code>的数据的字段。创建新<code class="codeph">Template</code> ，将<code class="codeph">MetadataState</code>传递给<code class="codeph">Template</code>的构造函数。当您调用<code class="codeph">DynamicDefinition</code>的<code class="codeph">getSource</code>方法时， <code class="codeph">MetadataState</code>将传递给<code class="codeph">SourceGenerator</code>的<code class="codeph">generateSource</code>方法。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">DataProvider</code>用于创建<code class="codeph">Template</code> ，由<code class="codeph">SourceGenerator</code>用于创建新的<code class="codeph">Source</code>对象。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">SourceGenerator</code>实现有一个<code class="codeph">generateSource</code>方法，该方法使用<code class="codeph">MetadataState</code>数据的当前状态来生成<code class="codeph">Template</code>的<code class="codeph">Source</code> 。您将<code class="codeph">SourceGenerator</code>传递给<code class="codeph">Template</code>的<code class="codeph">createDynamicDefinition</code>方法以创建<code class="codeph">DynamicDefinition</code> 。
                           </p>
                        </li>
                        <li>
                           <p>所述<code class="codeph">DynamicDefinition</code>具有<code class="codeph">getSource</code>方法，其获取<code class="codeph">Source</code>所生产<code class="codeph">SourceGenerator</code> 。<code class="codeph">DynamicDefinition</code>充当<code class="codeph">SourceDefinition</code>的代理， <code class="codeph">SourceDefinition</code>与<code class="codeph">Source</code> <code class="codeph">SourceDefinition</code>关联。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="OLAAP388"></a><div class="props_rev_3"><a id="GUID-09B314C5-2AAE-4874-B925-765CC89D8A37" name="GUID-09B314C5-2AAE-4874-B925-765CC89D8A37"></a><h4 id="OLAAP-GUID-09B314C5-2AAE-4874-B925-765CC89D8A37" class="sect4"><span class="enumeration_section">10.2.2</span>模板类</h4>
                  <div>
                     <p><a id="d28686e738" class="indexterm-anchor"></a>您使用<code class="codeph">Template</code>生成可修改的<code class="codeph">Source</code> 。<code class="codeph">Template</code>具有创建<code class="codeph">DynamicDefinition</code>以及获取和设置<code class="codeph">Template</code>当前状态的方法。在扩展<code class="codeph">Template</code>类时，您添加的方法可以访问<code class="codeph">Template</code>的<code class="codeph">MetadataState</code>上的字段。<code class="codeph">Template</code>创建一个<code class="codeph">DynamicDefinition</code> ，用于获取<code class="codeph">SourceGenerator</code>为<code class="codeph">Template</code>生成的<code class="codeph">Source</code> 。
                     </p>
                     <p>有关<code class="codeph">Template</code>实现的示例，请参见<a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">示例10-1</a> 。
                     </p>
                  </div>
               </div><a id="OLAAP389"></a><div class="props_rev_3"><a id="GUID-51205503-7C61-45C9-A482-C31A8B2B14A0" name="GUID-51205503-7C61-45C9-A482-C31A8B2B14A0"></a><h4 id="OLAAP-GUID-51205503-7C61-45C9-A482-C31A8B2B14A0" class="sect4"><span class="enumeration_section">10.2.3</span> MetadataState接口</h4>
                  <div>
                     <p><a id="d28686e825" class="indexterm-anchor"></a> <code class="codeph">MetadataState</code>接口的实现存储<code class="codeph">Template</code>的值的当前状态。<code class="codeph">MetadataState</code>必须包含一个<code class="codeph">clone</code>方法，该方法可以创建当前状态的副本。
                     </p>
                     <p>实例化新<code class="codeph">Template</code> ，将<code class="codeph">MetadataState</code>传递给<code class="codeph">Template</code>构造函数。<code class="codeph">Template</code>具有获取和设置<code class="codeph">MetadataState</code>存储的值的方法。所述<code class="codeph">generateSource</code>所述的方法<code class="codeph">SourceGenerator</code>为<code class="codeph">Template</code>使用<code class="codeph">MetadataState</code>当该方法产生一个<code class="codeph">Source</code>的<code class="codeph">Template</code> 。
                     </p>
                     <p>有关<code class="codeph">MetadataState</code>实现的示例，请参见<a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006260">示例10-2</a> 。
                     </p>
                  </div>
               </div><a id="OLAAP390"></a><div class="props_rev_3"><a id="GUID-14CAD029-22D0-4997-BEE1-CF7E8027C1B6" name="GUID-14CAD029-22D0-4997-BEE1-CF7E8027C1B6"></a><h4 id="OLAAP-GUID-14CAD029-22D0-4997-BEE1-CF7E8027C1B6" class="sect4"><span class="enumeration_section">10.2.4</span> SourceGenerator接口</h4>
                  <div>
                     <p><a id="d28686e918" class="indexterm-anchor"></a> <code class="codeph">SourceGenerator</code>的实现必须包含<code class="codeph">generateSource</code>方法，该方法为<code class="codeph">Template</code>生成<code class="codeph">Source</code> 。<code class="codeph">SourceGenerator</code>必须只生成一种类型的<code class="codeph">Source</code> ，例如<code class="codeph">BooleanSource</code> ， <code class="codeph">NumberSource</code>或<code class="codeph">StringSource</code> 。在生成<code class="codeph">Source</code> ， <code class="codeph">generateSource</code>方法使用<code class="codeph">MetadataState</code>为<code class="codeph">Template</code>表示的数据的当前状态。
                     </p>
                     <p>要获得<code class="codeph">Source</code>所生产<code class="codeph">generateSource</code>方法，您可以创建一个<code class="codeph">DynamicDefinition</code>通过将<code class="codeph">SourceGenerator</code>到<code class="codeph">createDynamicDefinition</code>的方法<code class="codeph">Template</code> 。然后通过调用<code class="codeph">DynamicDefinition</code>的<code class="codeph">getSource</code>方法获取<code class="codeph">Source</code> 。
                     </p>
                     <p><code class="codeph">Template</code>可以创建多个<code class="codeph">DynamicDefinition</code> ，每个都有一个不同的<code class="codeph">SourceGenerator</code> 。不同<code class="codeph">SourceGenerator</code>对象的<code class="codeph">generateSource</code>方法使用相同的数据（由<code class="codeph">Template</code>的<code class="codeph">MetadataState</code>的当前状态定义）来生成定义不同查询的<code class="codeph">Source</code>对象。
                     </p>
                     <p>有关<code class="codeph">SourceGenerator</code>实现的示例，请参见<a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006264">示例10-3</a> 。
                     </p>
                  </div>
               </div><a id="OLAAP391"></a><div class="props_rev_3"><a id="GUID-078501D4-94DB-42A3-A060-DDBAC039CD01" name="GUID-078501D4-94DB-42A3-A060-DDBAC039CD01"></a><h4 id="OLAAP-GUID-078501D4-94DB-42A3-A060-DDBAC039CD01" class="sect4"><span class="enumeration_section">10.2.5</span> DynamicDefinition类</h4>
                  <div>
                     <p><a id="d28686e1061" class="indexterm-anchor"></a> <code class="codeph">DynamicDefinition</code>是<code class="codeph">SourceDefinition</code>的子类。您可以通过调用<code class="codeph">Template</code>的<code class="codeph">createDynamicDefinition</code>方法并将其传递给<code class="codeph">SourceGenerator</code>创建<code class="codeph">DynamicDefinition</code> 。您可以通过调用<code class="codeph">DynamicDefinition</code>的<code class="codeph">getSource</code>方法获取<code class="codeph">SourceGenerator</code>生成的<code class="codeph">Source</code> 。
                     </p>
                     <p>甲<code class="codeph">DynamicDefinition</code>通过创建<code class="codeph">Template</code>是用于代理<code class="codeph">SourceDefinition</code>所述的<code class="codeph">Source</code>所生产<code class="codeph">SourceGenerator</code> 。<code class="codeph">SourceDefinition</code>与<code class="codeph">Source</code> <code class="codeph">SourceDefinition</code>相关联。如果的状态<code class="codeph">Template</code>的变化，则该<code class="codeph">Source</code>所生产<code class="codeph">SourceGenerator</code>是不同的。由于<code class="codeph">DynamicDefinition</code>是一个代理，因此即使<code class="codeph">Source</code>具有不同的<code class="codeph">SourceDefinition</code> ，您也可以使用相同的<code class="codeph">DynamicDefinition</code>来获取新的<code class="codeph">Source</code> 。
                     </p>
                     <p><code class="codeph">DynamicDefinition</code>的<code class="codeph">getCurrent</code>方法返回与<code class="codeph">generateSource</code>方法当前返回的<code class="codeph">Source</code>不可变地关联的<code class="codeph">SourceDefinition</code> 。有关使用<code class="codeph">DynamicDefinition</code> <a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">示例</a> ，请参见<a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">示例10-4</a> 。
                     </p>
                  </div>
               </div>
            </div><a id="OLAAP392"></a><div class="props_rev_3"><a id="GUID-BC9CA1ED-CA43-42C3-BB63-D70DF3F4CB43" name="GUID-BC9CA1ED-CA43-42C3-BB63-D70DF3F4CB43"></a><h3 id="OLAAP-GUID-BC9CA1ED-CA43-42C3-BB63-D70DF3F4CB43" class="sect3"><span class="enumeration_section">10.3</span>设计和实现模板</h3>
               <div>
                  <div class="section">
                     <p><a id="d28686e1203" class="indexterm-anchor"></a> <code class="codeph">Template</code>的设计反映了应用程序用户界面的查询构建元素。例如，假设您要开发一个应用程序，该应用程序允许最终用户创建一个查询，该查询从值列表的顶部或底部请求许多值。值来自度量的一个维度。该度量的其他维度仅限于单个值。
                     </p>
                     <p>应用程序的用户界面有一个对话框，允许最终用户执行以下操作：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>选择一个单选按钮，指定数据值是应该从值范围的顶部还是底部。</p>
                        </li>
                        <li>
                           <p>从度量下拉列表中选择度量。</p>
                        </li>
                        <li>
                           <p>从字段中选择一个数字。该数字指定要显示的数据值的数量。</p>
                        </li>
                        <li>
                           <p>选择度量的某个维度作为要显示的数据值的基础。例如，如果用户选择产品维度，则查询会从产品列表的顶部或底部指定一定数量的产品。该列表由度量和其他维度的选定值确定。</p>
                        </li>
                        <li>
                           <p>单击按钮以显示一个对话框，最终用户通过该对话框为所选度量的其他维度选择单个值。选择尺寸值后，最终用户单击第二个对话框上的“确定”按钮并返回到第一个对话框。</p>
                        </li>
                        <li>
                           <p>单击“确定”按钮以生成查询。查询结果出现。</p>
                        </li>
                     </ul>
                     <p>要生成表示最终用户在第一个对话框中创建的查询的<code class="codeph">Source</code> ，请设计名为<code class="codeph">TopBottomTemplate</code>的<code class="codeph">Template</code> 。您还设计了第二个名为<code class="codeph">SingleSelectionTemplate</code> <code class="codeph">Template</code> ，以创建一个<code class="codeph">Source</code> ，该<code class="codeph">Source</code>表示最终用户对基本维度以外的维度的单个值的选择。<code class="codeph">Template</code>对象的设计反映了对话框的用户界面元素。
                     </p>
                     <p>在设计<code class="codeph">TopBottomTemplate</code>及其<code class="codeph">MetadataState</code>和<code class="codeph">SourceGenerator</code> ，您将执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>创建一个名为<code class="codeph">TopBottomTemplate</code>的类来扩展<code class="codeph">Template</code> 。在类中，添加获取<code class="codeph">Template</code>当前状态的方法，设置用户指定的值，然后设置<code class="codeph">Template</code>的当前状态。
                           </p>
                        </li>
                        <li>
                           <p>创建一个名为<code class="codeph">TopBottomTemplateState</code>的类，该类实现<code class="codeph">MetadataState</code> 。您在类上提供字段以存储<code class="codeph">SourceGenerator</code>值，以用于生成<code class="codeph">Template</code>生成的<code class="codeph">Source</code> 。这些值由<code class="codeph">TopBottomTemplate</code>的方法设置。
                           </p>
                        </li>
                        <li>
                           <p>创建一个名为<code class="codeph">TopBottomTemplateGenerator</code>的类，它实现<code class="codeph">SourceGenerator</code> 。在类的<code class="codeph">generateSource</code>方法中，您提供了创建最终用户选择指定的<code class="codeph">Source</code>的操作。
                           </p>
                        </li>
                     </ul>
                     <p>使用您的应用程序，最终用户在第一个对话框中选择作为度量销售的单位和产品作为基本维度。最终用户还选择2001年第一季度的亚太地区和直接销售渠道作为每个剩余维度的单一值。</p>
                     <p>最终用户创建的查询要求在2001日历年期间通过直销渠道向亚太地区的客户销售的单位总数最高的十种产品。</p>
                     <p>对于的实施方式的示例<code class="codeph">TopBottomTemplate</code> ， <code class="codeph">TopBottomTemplateState</code> ，和<code class="codeph">TopBottomTemplateGenerator</code>类，以及使用它们的应用程序的一个例子，请参见<a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">实施例10-1</a> ， <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006260">实施例10-2</a> ， <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006264">实施例10-3</a> <span>和</span> <a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">实施例10-4</a> 。<code class="codeph">TopBottomTemplateState</code>和<code class="codeph">TopBottomTemplateGenerator</code>类是作为<code class="codeph">TopBottomTemplate</code>外部类的内部类实现的。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div><a id="OLAAP394"></a><a id="OLAAP395"></a><a id="OLAAP396"></a><a id="OLAAP393"></a><div class="props_rev_3"><a id="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E" name="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E"></a><h4 id="OLAAP-GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E" class="sect4"><span class="enumeration_section">10.3.1</span>实现模板的类</h4>
                  <div>
                     <div class="section">本主题中的示例实现<code class="codeph">Template</code> ， <code class="codeph">MetadataState</code>和<code class="codeph">SourceGenerator</code>类。
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">
                        <p class="titleinexample">例10-1实现模板</p>
                        <p><a id="d28686e1409" class="indexterm-anchor"></a><a id="d28686e1413" class="indexterm-anchor"></a>此示例是<code class="codeph">TopBottomTemplate</code>类的实现。
                        </p><pre class="oac_no_warn" dir="ltr">import oracle.olapi.data.source.DataProvider;
import oracle.olapi.data.source.DynamicDefinition;
import oracle.olapi.data.source.Source;
import oracle.olapi.data.source.SourceGenerator;
import oracle.olapi.data.source.Template;
import oracle.olapi.transaction.metadataStateManager.MetadataState;

/**
&nbsp;* Creates a TopBottomTemplateState, a TopBottomTemplateGenerator,
 * and a DynamicDefinition.
 * Gets the current state of the TopBottomTemplateState and the values 
 * that it stores. 
&nbsp;* Sets the data values stored by the TopBottomTemplateState and sets the
 * changed state as the current state.
&nbsp;*/
public class TopBottomTemplate extends Template 
{
// Constants for specifying the selection of elements from the 
// beginning or the end of the result set.
&nbsp;&nbsp;public static final int TOP_BOTTOM_TYPE_TOP = 0;
&nbsp;&nbsp;public static final int TOP_BOTTOM_TYPE_BOTTOM = 1;

&nbsp;&nbsp;// Variable to store the DynamicDefinition.
&nbsp;&nbsp;private DynamicDefinition dynamicDef;

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Creates a TopBottomTemplate with a default type and number values
&nbsp;&nbsp;&nbsp;* and the specified base dimension.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public TopBottomTemplate(Source base, DataProvider dataProvider)
  {
&nbsp;&nbsp;&nbsp;&nbsp;super(new TopBottomTemplateState(base, TOP_BOTTOM_TYPE_TOP, 0),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataProvider);
&nbsp;&nbsp;&nbsp;&nbsp;// Create the DynamicDefinition for this Template. Create the 
&nbsp;&nbsp;&nbsp;&nbsp;// TopBottomTemplateGenerator that the DynamicDefinition uses.
&nbsp;&nbsp;&nbsp;&nbsp;dynamicDef = 
&nbsp;&nbsp;&nbsp;&nbsp;createDynamicDefinition(new TopBottomTemplateGenerator(dataProvider));
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the Source produced by the TopBottomTemplateGenerator
&nbsp;&nbsp;&nbsp;* from the DynamicDefinition.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public final Source getSource() 
  {
&nbsp;&nbsp;&nbsp;&nbsp;return dynamicDef.getSource();
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the Source that is the base of the elements in the result set.
&nbsp;&nbsp;&nbsp;* Returns null if the state has no base.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public Source getBase()
  {
    TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
    return state.base;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
   * Sets a Source as the base.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public void setBase(Source base) 
  {
&nbsp;&nbsp;&nbsp;&nbsp; TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;state.base = base;
&nbsp;&nbsp;&nbsp;&nbsp;setCurrentState(state);
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the Source that specifies the measure and the single
&nbsp;&nbsp;&nbsp;* selections from the dimensions other than the base.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public Source getCriterion()
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;return state.criterion;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Specifies a Source that defines the measure and the single values 
&nbsp;&nbsp;&nbsp;* selected from the dimensions other than the base.
&nbsp;&nbsp;&nbsp;* The SingleSelectionTemplate produces such a Source.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public void setCriterion(Source criterion)
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;state.criterion = criterion;
&nbsp;&nbsp;&nbsp;&nbsp;setCurrentState(state);
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the type, which is either TOP_BOTTOM_TYPE_TOP or 
&nbsp;&nbsp;&nbsp;* TOP_BOTTOM_TYPE_BOTTOM.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public int getTopBottomType()
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;return state.topBottomType;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Sets the type.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public void setTopBottomType(int topBottomType)
  {
&nbsp;&nbsp;&nbsp;&nbsp;if ((topBottomType &lt; TOP_BOTTOM_TYPE_TOP) ||
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(topBottomType &gt; TOP_BOTTOM_TYPE_BOTTOM	))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new IllegalArgumentException("InvalidTopBottomType");
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;state.topBottomType = topBottomType;
&nbsp;&nbsp;&nbsp;&nbsp;setCurrentState(state);
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the number of values selected.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public float getN()
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;return state.N;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Sets the number of values to select.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public void setN(float N)
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;state.N = N;
&nbsp;&nbsp;&nbsp;&nbsp;setCurrentState(state);
&nbsp;&nbsp;}
}
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006260">
                        <p class="titleinexample">例10-2实现MetadataState</p>
                        <p><a id="d28686e1425" class="indexterm-anchor"></a>此示例是<code class="codeph">TopBottomTemplateState</code>内部类的实现。
                        </p><pre class="oac_no_warn" dir="ltr">/**
&nbsp;* Stores data that can be changed by a TopBottomTemplate.
&nbsp;* The data is used by a TopBottomTemplateGenerator in producing
&nbsp;* a Source for the TopBottomTemplate.
&nbsp;*/
private static final class TopBottomTemplateState
&nbsp;&nbsp;&nbsp;&nbsp; implements Cloneable, MetadataState
{
&nbsp;&nbsp;public int topBottomType;
&nbsp;&nbsp;public float N;
&nbsp;&nbsp;public Source criterion;
&nbsp;&nbsp;public Source base;

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Creates a TopBottomTemplateState.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public TopBottomTemplateState(Source base, int topBottomType, float N)
  {
&nbsp;&nbsp;&nbsp;&nbsp;this.base = base;
&nbsp;&nbsp;&nbsp;&nbsp;this.topBottomType = topBottomType;
&nbsp;&nbsp;&nbsp;&nbsp;this.N = N;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Creates a copy of this TopBottomTemplateState.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public final Object clone()
  {
&nbsp;&nbsp;&nbsp;&nbsp;try 
    {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return super.clone();
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;catch(CloneNotSupportedException e) 
    {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}
}
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006264">
                        <p class="titleinexample">示例10-3实现SourceGenerator</p>
                        <p><a id="d28686e1439" class="indexterm-anchor"></a>此示例是<code class="codeph">TopBottomTemplateGenerator</code>内部类的实现。
                        </p><pre class="oac_no_warn" dir="ltr">/**
&nbsp;* Produces a Source for a TopBottomTemplate based on the data
&nbsp;* values of a TopBottomTemplateState.
&nbsp;*/
private final class TopBottomTemplateGenerator
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implements SourceGenerator
{
&nbsp;&nbsp;// Store the DataProvider.
&nbsp;&nbsp;private DataProvider _dataProvider;

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Creates a TopBottomTemplateGenerator.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public TopBottomTemplateGenerator(DataProvider dataProvider)
  {
&nbsp;&nbsp;&nbsp;&nbsp;_dataProvider = dataProvider;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Generates a Source for a TopBottomTemplate using the current 
&nbsp;&nbsp;&nbsp;* state of the data values stored by the TopBottomTemplateState.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public Source generateSource(MetadataState state)
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState castState = (TopBottomTemplateState) state;
&nbsp;&nbsp;&nbsp;&nbsp;if (castState.criterion == null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new NullPointerException("CriterionParameterMissing");
&nbsp;&nbsp;&nbsp;&nbsp;Source sortedBase = null;

    // Depending on the topBottomType value, select from the base Source
    // the elements specified by the criterion Source and sort the
    // elements in ascending or descending order.
    // For descending order, specify that null values are last.
    // For ascending order, specify that null values are first.
       
&nbsp;&nbsp;&nbsp;&nbsp;if (castState.topBottomType == TOP_BOTTOM_TYPE_TOP)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sortedBase = castState.base.sortDescending(castState.criterion, false);
&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sortedBase = castState.base.sortAscending(castState.criterion, true);
&nbsp;&nbsp;&nbsp;&nbsp;return sortedBase.interval(1, Math.round(castState.N));
&nbsp;&nbsp;}
}</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="OLAAP398"></a><a id="OLAAP397"></a><div class="props_rev_3"><a id="GUID-C22245FA-E655-468E-8053-BAB7044C3F9B" name="GUID-C22245FA-E655-468E-8053-BAB7044C3F9B"></a><h4 id="OLAAP-GUID-C22245FA-E655-468E-8053-BAB7044C3F9B" class="sect4"><span class="enumeration_section">10.3.2</span>实现使用模板的应用程序</h4>
                  <div>
                     <div class="section">
                        <p><a id="d28686e1487" class="indexterm-anchor"></a><a id="d28686e1491" class="indexterm-anchor"></a>在最终用户在<code class="codeph">Template</code>的<code class="codeph">MetadataState</code>存储选择后，使用<code class="codeph">DynamicDefinition</code>的<code class="codeph">getSource</code>方法获取<code class="codeph">Template</code>创建的动态<code class="codeph">Source</code> 。本主题提供了使用<a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">示例10-1中</a>描述的<code class="codeph">TopBottomTemplate</code>的应用程序<a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">示例</a> 。为简洁起见，代码不包含太多异常处理。
                        </p>
                        <p>该<code class="codeph">BaseExample11g</code>类创建并存储的实例<code class="codeph">Context11g</code>类，它具有执行以下操作的方法：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>以命令行参数中的用户身份连接到Oracle数据库实例。</p>
                           </li>
                           <li>
                              <p>创建<code class="codeph">Cursor</code>对象并显示其值。
                              </p>
                           </li>
                        </ul>
                        <p><a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">例10-4</a>执行以下操作：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>获取<code class="codeph">MdmMetadataProvider</code>和<code class="codeph">MdmRootSchema</code> 。
                              </p>
                           </li>
                           <li>
                              <p>获取<code class="codeph">DataProvider</code> 。
                              </p>
                           </li>
                           <li>
                              <p>获取用户的<code class="codeph">MdmDatabaseSchema</code> 。
                              </p>
                           </li>
                           <li>
                              <p>获取具有COSTS，UNITS和SALES度量的<code class="codeph">MdmCube</code> 。从多维数据集中，该示例获取UNITS和SALES度量以及与多维数据集关联的维度。
                              </p>
                           </li>
                           <li>
                              <p><a id="d28686e1572" class="indexterm-anchor"></a>创建<code class="codeph">SingleSelectionTemplate</code>用于从度量的某些维度中选择单个值。有关此示例使用的<code class="codeph">SingleSelectionTemplate</code>类的代码，请参阅<a href="SingleSelectionTemplate-class.html#GUID-923EAA61-EFC2-4269-943F-9C0369837D4E">SingleSelectionTemplate类</a> 。
                              </p>
                           </li>
                           <li>
                              <p>创建<code class="codeph">TopBottomTemplate</code>并存储最终用户所做的选择。
                              </p>
                           </li>
                           <li>
                              <p>获取<code class="codeph">Source</code>所生产<code class="codeph">TopBottomTemplate</code> 。
                              </p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">Context11g</code>对象为该<code class="codeph">Source</code>创建<code class="codeph">Cursor</code>并显示<code class="codeph">Cursor</code>值。
                              </p>
                           </li>
                        </ul>
                        <p><a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">例7-3</a>的完整代码包含一些与<a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">例10-4中</a>相同的代码。该示例未显示此代码，该代码从<a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">示例10-4</a>的开头延伸到<a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">示例</a>中的以下注释：</p><pre class="oac_no_warn" dir="ltr">// End of code not shown in 
//<a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">Example 7-3</a>.</pre></div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">
                        <p class="titleinexample">示例10-4获取模板生成的源</p><pre class="oac_no_warn" dir="ltr">import oracle.olapi.data.source.DataProvider;
import oracle.olapi.data.source.Source;
import oracle.olapi.examples.*;
import oracle.olapi.metadata.mdm.MdmAttribute;
import oracle.olapi.metadata.mdm.MdmBaseMeasure;
import oracle.olapi.metadata.mdm.MdmCube;
import oracle.olapi.metadata.mdm.MdmDatabaseSchema;
import oracle.olapi.metadata.mdm.MdmDimensionLevel;
import oracle.olapi.metadata.mdm.MdmDimensionMemberInfo;
import oracle.olapi.metadata.mdm.MdmHierarchyLevel;
import oracle.olapi.metadata.mdm.MdmLevelHierarchy;
import oracle.olapi.metadata.mdm.MdmMetadataProvider;
import oracle.olapi.metadata.mdm.MdmPrimaryDimension;
import oracle.olapi.metadata.mdm.MdmRootSchema;

/**
&nbsp;* Creates a query that specifies a number of elements from the top
&nbsp;* or bottom of a selection of dimension members, creates a Cursor
 * for the query, and displays the values of the Cursor.
 * The selected dimension members are those that have measure values
 * that are specified by selected members of the other dimensions of
 * the measure.
&nbsp;*/
public class TopBottomTest extends BaseExample11g
{
  /**
   * Gets the MdmMetadataProvider, the DataProvider, the MdmRootSchema, and the
   * MdmDatabaseSchema for the current user.
   * Gets the UNITS_CUBE_AWJ MdmCube.
   * From the cube, gets the MdmBaseMeasure objects for the UNITS and SALES
   * measures and the MdmPrimaryDimension objects that dimension them.
   * Gets a hierarchy of the PRODUCT_AWJ dimension and the leaf level of the
   * dimension.
   * Gets the short description attribute of the dimension.
   * Creates a SingleSelectionTemplate and adds selections to it.
   * Creates a TopBottomTemplate and sets the properties of it.
   * Gets the Source produced by the TopBottomTemplate, creates a Cursor 
   * for it, and displays the values of the Cursor.
   * Changes the state of the SingleSelectionTemplate and the
   * TopBottomTemplate, creates a new Cursor for the Source produced by the
   * TopBottomTemplate, and displays the values of that Cursor.
   */
  public void run() throws Exception
  {
    // Get the MdmMetadataProvider from the superclass.
    MdmMetadataProvider metadataProvider = getMdmMetadataProvider();
    // Get the DataProvider from the Context11g object of the superclass.
    DataProvider dp = getContext().getDataProvider();

    // Get the MdmRootSchema and the MdmDatabaseSchema for the user.
    MdmRootSchema mdmRootSchema =
      (MdmRootSchema)metadataProvider.getRootSchema();
    MdmDatabaseSchema mdmDBSchema = 
      mdmRootSchema.getDatabaseSchema(getContext().getUser());

    MdmCube unitsCube =
      (MdmCube)mdmDBSchema.getTopLevelObject("UNITS_CUBE_AWJ");
    MdmBaseMeasure mdmUnits = unitsCube.findOrCreateBaseMeasure("UNITS");
    MdmBaseMeasure mdmSales = unitsCube.findOrCreateBaseMeasure("SALES");

    // Get the Source objects for the measures.
    Source units = mdmUnits.getSource();
    Source sales = mdmSales.getSource();

    // Get the MdmPrimaryDimension objects for the dimensions of the cube. 
    List&lt;MdmPrimaryDimension&gt; cubeDims = unitsCube.getDimensions();
    MdmPrimaryDimension mdmTimeDim = null;
    MdmPrimaryDimension mdmProdDim = null;
    MdmPrimaryDimension mdmCustDim = null;
    MdmPrimaryDimension mdmChanDim = null;
    
    for(MdmPrimaryDimension mdmPrimDim : cubeDims)
    {
      if (mdmPrimDim.getName().startsWith("TIME"))
        mdmTimeDim = mdmPrimDim;
      else if (mdmPrimDim.getName().startsWith("PROD"))
        mdmProdDim = mdmPrimDim;
      else if (mdmPrimDim.getName().startsWith("CUST"))
        mdmCustDim = mdmPrimDim;
      else if (mdmPrimDim.getName().startsWith("CHAN"))
        mdmChanDim = mdmPrimDim;
    }

    // Get the hierarchy of the PRODUCT_AWJ dimension.
    MdmLevelHierarchy mdmProdHier = 
      mdmProdDim.findOrCreateLevelHierarchy("PRODUCT_PRIMARY");

    // Get the detail dimenson level of the PRODUCT_AWJ dimension.
    MdmDimensionLevel mdmItemDimLevel = 
      mdmProdDim.findOrCreateDimensionLevel("ITEM");
    // Get the hierarchy level of the dimension level.
    MdmHierarchyLevel mdmItemHierLevel = 
                       mdmProdHier.findOrCreateHierarchyLevel(mdmItemDimLevel);       
    // Get the Source for the hierarchy level.
    Source itemLevel = mdmItemHierLevel.getSource();

    // Get the short description attribute for the PRODUCT_AWJ dimension and
    // the Source for the attribute.
    MdmAttribute mdmProdShortDescrAttr = 
      mdmProdDim.getShortValueDescriptionAttribute();
    Source prodShortDescrAttr = mdmProdShortDescrAttr.getSource();

    // Create a SingleSelectionTemplate to produce a Source that
    // represents the measure values specified by single members of each of
    // the dimensions of the measure other than the base dimension.
    SingleSelectionTemplate singleSelections =
      new SingleSelectionTemplate(units, dp);

    // Create MdmDimensionMemberInfo objects for single members of the
    // other dimensions of the measure.
    MdmDimensionMemberInfo timeMemInfo =
      new MdmDimensionMemberInfo(mdmTimeDim, "CALENDAR_YEAR::YEAR::CY2001");
    MdmDimensionMemberInfo custMemInfo =
      new MdmDimensionMemberInfo(mdmCustDim, "SHIPMENTS::REGION::APAC");
    MdmDimensionMemberInfo chanMemInfo =
      new MdmDimensionMemberInfo(mdmChanDim, "CHANNEL_PRIMARY::CHANNEL::DIR");
 
    // Add the dimension member information objects to the
    // SingleSelectionTemplate.
    singleSelections.addDimMemberInfo(custMemInfo);
    singleSelections.addDimMemberInfo(chanMemInfo);
    singleSelections.addDimMemberInfo(timeMemInfo);

    // Create a TopBottomTemplate specifying, as the base, the Source for a
    // a level of a hierarchy.
    TopBottomTemplate topNBottom = new TopBottomTemplate(itemLevel, dp);

    // Specify whether to retrieve the elements from the beginning (top) or the
    // end (bottom) of the selected elements of the base dimension.
    topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_TOP);

    // Set the number of elements of the base dimension to retrieve.
    topNBottom.setN(10);
    // Get the Source produced by the SingleSelectionTemplate and specify it as
    // the criterion object.
    topNBottom.setCriterion(singleSelections.getSource());

    // End of code not shown in 
    // <a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">Example 7-3</a>.

    // Display a description of the result.
    String resultDescription = " products with the most units sold \nfor";
    displayResultDescr(singleSelections, topNBottom, resultDescription);

    // Get the Source produced by the TopBottomTemplate.
    Source result = topNBottom.getSource();

    // Join the Source produced by the TopBottomTemplate with the short
    // value descriptions. Use the joinHidden method so that the
    // dimension member values do not appear in the result.
    Source result = prodShortDescrAttr.joinHidden(topNBottomResult);

    // Commit the current transaction.
    getContext().commit();  // Method of Context11g.

    // Create a Cursor for the result and display the values of the Cursor.
    getContext().displayTopBottomResult(result);

    // Change a dimension member selection of the SingleSelectionTemplate.
    timeMemInfo.setUniqueValue("CALENDAR_YEAR::YEAR::CY2000");
    singleSelections.changeSelection(timeMemInfo);
 
    // Change the number of elements selected and the type of selection.
    topNBottom.setN(5);
    topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_BOTTOM);
 
    // Join the Source produced by the TopBottomTemplate to the short
    // description attribute.
    result = prodShortDescrAttr.joinHidden(topNBottomResult);

    // Commit the current transaction.
    getContext().commit();
 
    // Display a description of the result.
    resultDescription = " products with the fewest units sold \nfor";
    displayResultDescr(singleSelections, topNBottom, resultDescription);
 
    // Create a new Cursor for the Source produced by the TopBottomTemplate
    // and display the Cursor values.
    getContext().displayTopBottomResult(result);

    // Now change the measure to SALES, and get the top and bottom products by
    // SALES.    
    singleSelections.setMeasure(sales);
    // Change the number of elements selected.
    topNBottom.setN(7);
    // Change the type of selection back to the top.
    topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_TOP);

    resultDescription = " products with the highest sales amounts \nfor";
    displayResultDescr(singleSelections, topNBottom, resultDescription);

    topNBottomResult = topNBottom.getSource();
    result = prodShortDescrAttr.joinHidden(topNBottomResult);
    
    // Commit the current transaction.
    getContext().commit();
    getContext().displayTopBottomResult(result);

    // Change the type of selection back to the bottom.
    topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_BOTTOM);

    resultDescription = " products with the lowest sales amounts \nfor";
    displayResultDescr(singleSelections, topNBottom, resultDescription);

    topNBottomResult = topNBottom.getSource();
    result = prodShortDescrAttr.joinHidden(topNBottomResult);
    
    // Commit the current transaction.
    getContext().commit();
    getContext().displayTopBottomResult(result);

  } 

  /**
   * Displays a description of the results of the query.
   * 
   * @param singleSelections The SingleSelectionsTemplate used by the query.
   * 
   * @param topNBottom The TopBottomTemplate used by the query.
   * 
   * @param resultDescr A String that contains a description of the query.
   */
  private void displayResultDescr(SingleSelectionTemplate singleSelections,
                                  TopBottomTemplate topNBottom,
                                  String resultDescr)
  {
    DataProvider dp = getContext().getDataProvider();
    
    // Get the short descriptions of the dimension members of the  
    // SingleSelectionTemplate.
    StringBuffer shortDescrsForMemberVals =
      singleSelections.getMemberShortDescrs(dp);
    
    // Display the number of dimension members selected, the result description,
    // and the short descriptions of the single selection dimension members.
    println("\nThe " + Math.round(topNBottom.getN()) + resultDescr
            + shortDescrsForMemberVals +" are:\n"); 
  }

  /**
   * Runs the TopBottomTest application.
   *
   * @param args An array of String objects that provides the arguments
   *             required to connect to an Oracle Database instance, as
   *             specified in the Context11g class.
   */
  public static void main(String[] args) 
  {
    new TopBottomTest().execute(args);
  }</pre><p>}</p>
                        <p><code class="codeph">TopBottomTest</code>程序生成以下输出。
                        </p><pre class="oac_no_warn" dir="ltr">The 10 products with the most units sold
for Asia Pacific, Direct Sales, 2001 are:

 1. Mouse Pad
 2. Unix/Windows 1-user pack
 3. Deluxe Mouse
 4. Laptop carrying case
 5. 56Kbps V.90 Type II Modem
 6. 56Kbps V.92 Type II Fax/Modem
 7. Keyboard Wrist Rest
 8. Internal - DVD-RW - 6X
 9. O/S Documentation Set - English
10. External - DVD-RW - 8X
 
The 5 products with the fewest units sold
for Asia Pacific, Direct Sales, 2000 are:
 
 1. Envoy External Keyboard
 2. O/S Documentation Set - Italian
 3. External 48X CD-ROM
 4. O/S Documentation Set - Spanish
 5. Internal 48X CD-ROM USB

The 7 products with the highest sales amounts 
for Asia Pacific, Direct Sales, 2000 are:
 
 1. Sentinel Financial
 2. Sentinel Standard
 3. Envoy Executive
 4. Sentinel Multimedia
 5. Envoy Standard
 6. Envoy Ambassador
 7. 56Kbps V.90 Type II Modem
 
The 7 products with the lowest sales amounts 
for Asia Pacific, Direct Sales, 2000 are:

 1. Envoy External Keyboard
 2. Keyboard Wrist Rest
 3. Mouse Pad
 4. O/S Documentation Set - Italian
 5. O/S Documentation Set - Spanish
 6. Standard Mouse
 7. O/S Documentation Set - French</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>